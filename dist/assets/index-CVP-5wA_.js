function sr(r,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in r)){const n=Object.getOwnPropertyDescriptor(s,i);n&&Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var Ye=function(r,e){return Ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])},Ye(r,e)};function Kt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ye(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var xe=function(){return xe=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},xe.apply(this,arguments)};function he(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t}function Jt(r,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,s);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(n=(i<3?a(n):i>3?a(e,t,n):a(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n}function Gt(r,e){return function(t,s){e(t,s,r)}}function Yt(r,e,t,s,i,n){function a(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var o=s.kind,c=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&r?s.static?r:r.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,s.name):{}),f,u=!1,h=t.length-1;h>=0;h--){var m={};for(var g in s)m[g]=g==="access"?{}:s[g];for(var g in s.access)m.access[g]=s.access[g];m.addInitializer=function(v){if(u)throw new TypeError("Cannot add initializers after decoration has completed");n.push(a(v||null))};var p=(0,t[h])(o==="accessor"?{get:d.get,set:d.set}:d[c],m);if(o==="accessor"){if(p===void 0)continue;if(p===null||typeof p!="object")throw new TypeError("Object expected");(f=a(p.get))&&(d.get=f),(f=a(p.set))&&(d.set=f),(f=a(p.init))&&i.unshift(f)}else(f=a(p))&&(o==="field"?i.unshift(f):d[c]=f)}l&&Object.defineProperty(l,s.name,d),u=!0}function Qt(r,e,t){for(var s=arguments.length>2,i=0;i<e.length;i++)t=s?e[i].call(r,t):e[i].call(r);return s?t:void 0}function Xt(r){return typeof r=="symbol"?r:"".concat(r)}function Zt(r,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function es(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function _(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{l(s.next(d))}catch(f){a(f)}}function c(d){try{l(s.throw(d))}catch(f){a(f)}}function l(d){d.done?n(d.value):i(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})}function ts(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,i,n,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(l){return function(d){return c([l,d])}}function c(l){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(t=0)),t;)try{if(s=1,i&&(n=l[0]&2?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){t.label=l[1];break}if(l[0]===6&&t.label<n[1]){t.label=n[1],n=l;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(l);break}n[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(d){l=[6,d],i=0}finally{s=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var Le=Object.create?function(r,e,t,s){s===void 0&&(s=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,i)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]};function ss(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Le(e,r,t)}function $e(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function dt(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var s=t.call(r),i,n=[],a;try{for(;(e===void 0||e-- >0)&&!(i=s.next()).done;)n.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(a)throw a.error}}return n}function rs(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(dt(arguments[e]));return r}function is(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var s=Array(r),i=0,e=0;e<t;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,i++)s[i]=n[a];return s}function ns(r,e,t){if(t||arguments.length===2)for(var s=0,i=e.length,n;s<i;s++)(n||!(s in e))&&(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return r.concat(n||Array.prototype.slice.call(e))}function ue(r){return this instanceof ue?(this.v=r,this):new ue(r)}function as(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(r,e||[]),i,n=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(h){return function(m){return Promise.resolve(m).then(h,f)}}function o(h,m){s[h]&&(i[h]=function(g){return new Promise(function(p,v){n.push([h,g,p,v])>1||c(h,g)})},m&&(i[h]=m(i[h])))}function c(h,m){try{l(s[h](m))}catch(g){u(n[0][3],g)}}function l(h){h.value instanceof ue?Promise.resolve(h.value.v).then(d,f):u(n[0][2],h)}function d(h){c("next",h)}function f(h){c("throw",h)}function u(h,m){h(m),n.shift(),n.length&&c(n[0][0],n[0][1])}}function os(r){var e,t;return e={},s("next"),s("throw",function(i){throw i}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(i,n){e[i]=r[i]?function(a){return(t=!t)?{value:ue(r[i](a)),done:!1}:n?n(a):a}:n}}function cs(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof $e=="function"?$e(r):r[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=r[n]&&function(a){return new Promise(function(o,c){a=r[n](a),i(o,c,a.done,a.value)})}}function i(n,a,o,c){Promise.resolve(c).then(function(l){n({value:l,done:o})},a)}}function ls(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}var rr=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},Qe=function(r){return Qe=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},Qe(r)};function ds(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=Qe(r),s=0;s<t.length;s++)t[s]!=="default"&&Le(e,r,t[s]);return rr(e,r),e}function us(r){return r&&r.__esModule?r:{default:r}}function hs(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}function fs(r,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t}function ps(r,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?e===r:r.has(e)}function ms(r,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],t&&(i=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");i&&(s=function(){try{i.call(this)}catch(n){return Promise.reject(n)}}),r.stack.push({value:e,dispose:s,async:t})}else t&&r.stack.push({async:!0});return e}var ir=typeof SuppressedError=="function"?SuppressedError:function(r,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=r,s.suppressed=e,s};function gs(r){function e(n){r.error=r.hasError?new ir(n,r.error,"An error was suppressed during disposal."):n,r.hasError=!0}var t,s=0;function i(){for(;t=r.stack.pop();)try{if(!t.async&&s===1)return s=0,r.stack.push(t),Promise.resolve().then(i);if(t.dispose){var n=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(n).then(i,function(a){return e(a),i()})}else s|=1}catch(a){e(a)}if(s===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return i()}function vs(r,e){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,s,i,n,a){return s?e?".jsx":".js":i&&(!n||!a)?t:i+n+"."+a.toLowerCase()+"js"}):r}const nr={__extends:Kt,__assign:xe,__rest:he,__decorate:Jt,__param:Gt,__esDecorate:Yt,__runInitializers:Qt,__propKey:Xt,__setFunctionName:Zt,__metadata:es,__awaiter:_,__generator:ts,__createBinding:Le,__exportStar:ss,__values:$e,__read:dt,__spread:rs,__spreadArrays:is,__spreadArray:ns,__await:ue,__asyncGenerator:as,__asyncDelegator:os,__asyncValues:cs,__makeTemplateObject:ls,__importStar:ds,__importDefault:us,__classPrivateFieldGet:hs,__classPrivateFieldSet:fs,__classPrivateFieldIn:ps,__addDisposableResource:ms,__disposeResources:gs,__rewriteRelativeImportExtension:vs},ar=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ms,get __assign(){return xe},__asyncDelegator:os,__asyncGenerator:as,__asyncValues:cs,__await:ue,__awaiter:_,__classPrivateFieldGet:hs,__classPrivateFieldIn:ps,__classPrivateFieldSet:fs,__createBinding:Le,__decorate:Jt,__disposeResources:gs,__esDecorate:Yt,__exportStar:ss,__extends:Kt,__generator:ts,__importDefault:us,__importStar:ds,__makeTemplateObject:ls,__metadata:es,__param:Gt,__propKey:Xt,__read:dt,__rest:he,__rewriteRelativeImportExtension:vs,__runInitializers:Qt,__setFunctionName:Zt,__spread:rs,__spreadArray:ns,__spreadArrays:is,__values:$e,default:nr},Symbol.toStringTag,{value:"Module"})),or=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);class ut extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class cr extends ut{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class bt extends ut{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class _t extends ut{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Xe;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Xe||(Xe={}));class lr{constructor(e,{headers:t={},customFetch:s,region:i=Xe.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=or(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return _(this,arguments,void 0,function*(t,s={}){var i;let n,a;try{const{headers:o,method:c,body:l,signal:d,timeout:f}=s;let u={},{region:h}=s;h||(h=this.region);const m=new URL(`${this.url}/${t}`);h&&h!=="any"&&(u["x-region"]=h,m.searchParams.set("forceFunctionRegion",h));let g;l&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",g=l):typeof l=="string"?(u["Content-Type"]="text/plain",g=l):typeof FormData<"u"&&l instanceof FormData?g=l:(u["Content-Type"]="application/json",g=JSON.stringify(l)):g=l;let p=d;f&&(a=new AbortController,n=setTimeout(()=>a.abort(),f),d?(p=a.signal,d.addEventListener("abort",()=>a.abort())):p=a.signal);const v=yield this.fetch(m.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),o),body:g,signal:p}).catch(O=>{throw new cr(O)}),b=v.headers.get("x-relay-error");if(b&&b==="true")throw new bt(v);if(!v.ok)throw new _t(v);let y=((i=v.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),E;return y==="application/json"?E=yield v.json():y==="application/octet-stream"||y==="application/pdf"?E=yield v.blob():y==="text/event-stream"?E=v:y==="multipart/form-data"?E=yield v.formData():E=yield v.text(),{data:E,error:null,response:v}}catch(o){return{data:null,error:o,response:o instanceof _t||o instanceof bt?o.context:void 0}}finally{n&&clearTimeout(n)}})}}function dr(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var i=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return r[s]}})}),t}var N={};const fe=dr(ar);var ke={},Oe={},je={},Te={},Re={},Ae={},wt;function ys(){if(wt)return Ae;wt=1,Object.defineProperty(Ae,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Ae.default=r,Ae}var Et;function bs(){if(Et)return Re;Et=1,Object.defineProperty(Re,"__esModule",{value:!0});const e=fe.__importDefault(ys());class t{constructor(i){var n,a;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(n=i.shouldThrowOnError)!==null&&n!==void 0?n:!1,this.signal=i.signal,this.isMaybeSingle=(a=i.isMaybeSingle)!==null&&a!==void 0?a:!1,i.fetch?this.fetch=i.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,n){return this.headers=new Headers(this.headers),this.headers.set(i,n),this}then(i,n){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var l,d,f,u;let h=null,m=null,g=null,p=c.status,v=c.statusText;if(c.ok){if(this.method!=="HEAD"){const O=await c.text();O===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((l=this.headers.get("Accept"))===null||l===void 0)&&l.includes("application/vnd.pgrst.plan+text"))?m=O:m=JSON.parse(O))}const y=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),E=(f=c.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");y&&E&&E.length>1&&(g=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(h={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,g=null,p=406,v="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const y=await c.text();try{h=JSON.parse(y),Array.isArray(h)&&c.status===404&&(m=[],h=null,p=200,v="OK")}catch{c.status===404&&y===""?(p=204,v="No Content"):h={message:y}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,p=200,v="OK"),h&&this.shouldThrowOnError)throw new e.default(h)}return{error:h,data:m,count:g,status:p,statusText:v}});return this.shouldThrowOnError||(o=o.catch(c=>{var l,d,f;return{error:{message:`${(l=c==null?void 0:c.name)!==null&&l!==void 0?l:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(d=c==null?void 0:c.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=c==null?void 0:c.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),o.then(i,n)}returns(){return this}overrideTypes(){return this}}return Re.default=t,Re}var St;function _s(){if(St)return Te;St=1,Object.defineProperty(Te,"__esModule",{value:!0});const e=fe.__importDefault(bs());class t extends e.default{select(i){let n=!1;const a=(i??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:n=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",d=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${d?`${d},`:""}${i}.${n?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${i}`),this}range(i,n,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${i}`),this.url.searchParams.set(l,`${n-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:n=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var d;const f=[i?"analyze":null,n?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),u=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${u}"; options=${f};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Te.default=t,Te}var kt;function ht(){if(kt)return je;kt=1,Object.defineProperty(je,"__esModule",{value:!0});const e=fe.__importDefault(_s()),t=new RegExp("[,()]");class s extends e.default{eq(n,a){return this.url.searchParams.append(n,`eq.${a}`),this}neq(n,a){return this.url.searchParams.append(n,`neq.${a}`),this}gt(n,a){return this.url.searchParams.append(n,`gt.${a}`),this}gte(n,a){return this.url.searchParams.append(n,`gte.${a}`),this}lt(n,a){return this.url.searchParams.append(n,`lt.${a}`),this}lte(n,a){return this.url.searchParams.append(n,`lte.${a}`),this}like(n,a){return this.url.searchParams.append(n,`like.${a}`),this}likeAllOf(n,a){return this.url.searchParams.append(n,`like(all).{${a.join(",")}}`),this}likeAnyOf(n,a){return this.url.searchParams.append(n,`like(any).{${a.join(",")}}`),this}ilike(n,a){return this.url.searchParams.append(n,`ilike.${a}`),this}ilikeAllOf(n,a){return this.url.searchParams.append(n,`ilike(all).{${a.join(",")}}`),this}ilikeAnyOf(n,a){return this.url.searchParams.append(n,`ilike(any).{${a.join(",")}}`),this}is(n,a){return this.url.searchParams.append(n,`is.${a}`),this}in(n,a){const o=Array.from(new Set(a)).map(c=>typeof c=="string"&&t.test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(n,`in.(${o})`),this}contains(n,a){return typeof a=="string"?this.url.searchParams.append(n,`cs.${a}`):Array.isArray(a)?this.url.searchParams.append(n,`cs.{${a.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(a)}`),this}containedBy(n,a){return typeof a=="string"?this.url.searchParams.append(n,`cd.${a}`):Array.isArray(a)?this.url.searchParams.append(n,`cd.{${a.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(a)}`),this}rangeGt(n,a){return this.url.searchParams.append(n,`sr.${a}`),this}rangeGte(n,a){return this.url.searchParams.append(n,`nxl.${a}`),this}rangeLt(n,a){return this.url.searchParams.append(n,`sl.${a}`),this}rangeLte(n,a){return this.url.searchParams.append(n,`nxr.${a}`),this}rangeAdjacent(n,a){return this.url.searchParams.append(n,`adj.${a}`),this}overlaps(n,a){return typeof a=="string"?this.url.searchParams.append(n,`ov.${a}`):this.url.searchParams.append(n,`ov.{${a.join(",")}}`),this}textSearch(n,a,{config:o,type:c}={}){let l="";c==="plain"?l="pl":c==="phrase"?l="ph":c==="websearch"&&(l="w");const d=o===void 0?"":`(${o})`;return this.url.searchParams.append(n,`${l}fts${d}.${a}`),this}match(n){return Object.entries(n).forEach(([a,o])=>{this.url.searchParams.append(a,`eq.${o}`)}),this}not(n,a,o){return this.url.searchParams.append(n,`not.${a}.${o}`),this}or(n,{foreignTable:a,referencedTable:o=a}={}){const c=o?`${o}.or`:"or";return this.url.searchParams.append(c,`(${n})`),this}filter(n,a,o){return this.url.searchParams.append(n,`${a}.${o}`),this}}return je.default=s,je}var Ot;function ws(){if(Ot)return Oe;Ot=1,Object.defineProperty(Oe,"__esModule",{value:!0});const e=fe.__importDefault(ht());class t{constructor(i,{headers:n={},schema:a,fetch:o}){this.url=i,this.headers=new Headers(n),this.schema=a,this.fetch=o}select(i,n){const{head:a=!1,count:o}=n??{},c=a?"HEAD":"GET";let l=!1;const d=(i??"*").split("").map(f=>/\s/.test(f)&&!l?"":(f==='"'&&(l=!l),f)).join("");return this.url.searchParams.set("select",d),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:n,defaultToNull:a=!0}={}){var o;const c="POST";if(n&&this.headers.append("Prefer",`count=${n}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const l=i.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(l.length>0){const d=[...new Set(l)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(i,{onConflict:n,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){var l;const d="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),n!==void 0&&this.url.searchParams.set("on_conflict",n),o&&this.headers.append("Prefer",`count=${o}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const f=i.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(f.length>0){const u=[...new Set(f)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(i,{count:n}={}){var a;const o="PATCH";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:i}={}){var n;const a="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}}return Oe.default=t,Oe}var jt;function ur(){if(jt)return ke;jt=1,Object.defineProperty(ke,"__esModule",{value:!0});const r=fe,e=r.__importDefault(ws()),t=r.__importDefault(ht());class s{constructor(n,{headers:a={},schema:o,fetch:c}={}){this.url=n,this.headers=new Headers(a),this.schemaName=o,this.fetch=c}from(n){const a=new URL(`${this.url}/${n}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new s(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,a={},{head:o=!1,get:c=!1,count:l}={}){var d;let f;const u=new URL(`${this.url}/rpc/${n}`);let h;o||c?(f=o?"HEAD":"GET",Object.entries(a).filter(([g,p])=>p!==void 0).map(([g,p])=>[g,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([g,p])=>{u.searchParams.append(g,p)})):(f="POST",h=a);const m=new Headers(this.headers);return l&&m.set("Prefer",`count=${l}`),new t.default({method:f,url:u,headers:m,schema:this.schemaName,body:h,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return ke.default=s,ke}Object.defineProperty(N,"__esModule",{value:!0});var Es=N.PostgrestError=Is=N.PostgrestBuilder=Cs=N.PostgrestTransformBuilder=Rs=N.PostgrestFilterBuilder=js=N.PostgrestQueryBuilder=ks=N.PostgrestClient=void 0;const pe=fe,Ss=pe.__importDefault(ur());var ks=N.PostgrestClient=Ss.default;const Os=pe.__importDefault(ws());var js=N.PostgrestQueryBuilder=Os.default;const Ts=pe.__importDefault(ht());var Rs=N.PostgrestFilterBuilder=Ts.default;const As=pe.__importDefault(_s());var Cs=N.PostgrestTransformBuilder=As.default;const Ps=pe.__importDefault(bs());var Is=N.PostgrestBuilder=Ps.default;const xs=pe.__importDefault(ys());Es=N.PostgrestError=xs.default;var $s=N.default={PostgrestClient:Ss.default,PostgrestQueryBuilder:Os.default,PostgrestFilterBuilder:Ts.default,PostgrestTransformBuilder:As.default,PostgrestBuilder:Ps.default,PostgrestError:xs.default};const hr=sr({__proto__:null,get PostgrestBuilder(){return Is},get PostgrestClient(){return ks},get PostgrestError(){return Es},get PostgrestFilterBuilder(){return Rs},get PostgrestQueryBuilder(){return js},get PostgrestTransformBuilder(){return Cs},default:$s},[N]),{PostgrestClient:fr,PostgrestQueryBuilder:xn,PostgrestFilterBuilder:$n,PostgrestTransformBuilder:Nn,PostgrestBuilder:Un,PostgrestError:qn}=$s||hr;class pr{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const s=t.node,i=parseInt(s.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const mr="2.81.1",gr=`realtime-js/${mr}`,Ns="1.0.0",vr="2.0.0",Tt=Ns,Ze=1e4,yr=1e3,br=100;var Z;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Z||(Z={}));var x;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(x||(x={}));var z;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(z||(z={}));var et;(function(r){r.websocket="websocket"})(et||(et={}));var ee;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ee||(ee={}));class _r{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodePush(e){const{join_ref:t,ref:s,event:i,topic:n,payload:a}=e,o=this.META_LENGTH+t.length+s.length+n.length+i.length,c=new ArrayBuffer(this.HEADER_LENGTH+o);let l=new DataView(c),d=0;l.setUint8(d++,this.KINDS.push),l.setUint8(d++,t.length),l.setUint8(d++,s.length),l.setUint8(d++,n.length),l.setUint8(d++,i.length),Array.from(t,u=>l.setUint8(d++,u.charCodeAt(0))),Array.from(s,u=>l.setUint8(d++,u.charCodeAt(0))),Array.from(n,u=>l.setUint8(d++,u.charCodeAt(0))),Array.from(i,u=>l.setUint8(d++,u.charCodeAt(0)));var f=new Uint8Array(c.byteLength+a.byteLength);return f.set(new Uint8Array(c),0),f.set(new Uint8Array(a),c.byteLength),f.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;const{join_ref:i,ref:n,topic:a}=e,o=e.payload.event,c=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0),l=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+n.length+a.length+o.length,d=new ArrayBuffer(this.HEADER_LENGTH+l);let f=new DataView(d),u=0;f.setUint8(u++,this.KINDS.userBroadcastPush),f.setUint8(u++,i.length),f.setUint8(u++,n.length),f.setUint8(u++,a.length),f.setUint8(u++,o.length),f.setUint8(u++,this.BINARY_ENCODING),Array.from(i,m=>f.setUint8(u++,m.charCodeAt(0))),Array.from(n,m=>f.setUint8(u++,m.charCodeAt(0))),Array.from(a,m=>f.setUint8(u++,m.charCodeAt(0))),Array.from(o,m=>f.setUint8(u++,m.charCodeAt(0)));var h=new Uint8Array(d.byteLength+c.byteLength);return h.set(new Uint8Array(d),0),h.set(new Uint8Array(c),d.byteLength),h.buffer}_encodeJsonUserBroadcastPush(e){var t,s;const{join_ref:i,ref:n,topic:a}=e,o=e.payload.event,c=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},d=new TextEncoder().encode(JSON.stringify(c)).buffer,f=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+n.length+a.length+o.length,u=new ArrayBuffer(this.HEADER_LENGTH+f);let h=new DataView(u),m=0;h.setUint8(m++,this.KINDS.userBroadcastPush),h.setUint8(m++,i.length),h.setUint8(m++,n.length),h.setUint8(m++,a.length),h.setUint8(m++,o.length),h.setUint8(m++,this.JSON_ENCODING),Array.from(i,p=>h.setUint8(m++,p.charCodeAt(0))),Array.from(n,p=>h.setUint8(m++,p.charCodeAt(0))),Array.from(a,p=>h.setUint8(m++,p.charCodeAt(0))),Array.from(o,p=>h.setUint8(m++,p.charCodeAt(0)));var g=new Uint8Array(u.byteLength+d.byteLength);return g.set(new Uint8Array(u),0),g.set(new Uint8Array(d),u.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){const s=JSON.parse(e),[i,n,a,o,c]=s;return t({join_ref:i,ref:n,topic:a,event:o,payload:c})}return t({})}_binaryDecode(e){const t=new DataView(e),s=t.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.push:return this._decodePush(e,t,i);case this.KINDS.reply:return this._decodeReply(e,t,i);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,i);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,i)}}_decodePush(e,t,s){const i=t.getUint8(1),n=t.getUint8(2),a=t.getUint8(3);let o=this.HEADER_LENGTH+this.META_LENGTH-1;const c=s.decode(e.slice(o,o+i));o=o+i;const l=s.decode(e.slice(o,o+n));o=o+n;const d=s.decode(e.slice(o,o+a));o=o+a;const f=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{join_ref:c,ref:null,topic:l,event:d,payload:f}}_decodeReply(e,t,s){const i=t.getUint8(1),n=t.getUint8(2),a=t.getUint8(3),o=t.getUint8(4);let c=this.HEADER_LENGTH+this.META_LENGTH;const l=s.decode(e.slice(c,c+i));c=c+i;const d=s.decode(e.slice(c,c+n));c=c+n;const f=s.decode(e.slice(c,c+a));c=c+a;const u=s.decode(e.slice(c,c+o));c=c+o;const h=JSON.parse(s.decode(e.slice(c,e.byteLength))),m={status:u,response:h};return{join_ref:l,ref:d,topic:f,event:z.reply,payload:m}}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+i));a=a+i;const c=s.decode(e.slice(a,a+n));a=a+n;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{join_ref:null,ref:null,topic:o,event:c,payload:l}}_decodeUserBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2),a=t.getUint8(3),o=t.getUint8(4);let c=this.HEADER_LENGTH+4;const l=s.decode(e.slice(c,c+i));c=c+i;const d=s.decode(e.slice(c,c+n));c=c+n;const f=s.decode(e.slice(c,c+a));c=c+a;const u=e.slice(c,e.byteLength),h=o===this.JSON_ENCODING?JSON.parse(s.decode(u)):u,m={type:this.BROADCAST,event:d,payload:h};return a>0&&(m.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST,payload:m}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class Us{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var T;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(T||(T={}));const Rt=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((n,a)=>(n[a]=wr(a,r,e,i),n),{}):{}},wr=(r,e,t,s)=>{const i=e.find(o=>o.name===r),n=i==null?void 0:i.type,a=t[r];return n&&!s.includes(n)?qs(n,a):tt(a)},qs=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Or(e,t)}switch(r){case T.bool:return Er(e);case T.float4:case T.float8:case T.int2:case T.int4:case T.int8:case T.numeric:case T.oid:return Sr(e);case T.json:case T.jsonb:return kr(e);case T.timestamp:return jr(e);case T.abstime:case T.date:case T.daterange:case T.int4range:case T.int8range:case T.money:case T.reltime:case T.text:case T.time:case T.timestamptz:case T.timetz:case T.tsrange:case T.tstzrange:return tt(e);default:return tt(e)}},tt=r=>r,Er=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Sr=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},kr=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Or=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>qs(e,o))}return r},jr=r=>typeof r=="string"?r.replace(" ","T"):r,Ls=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class ze{constructor(e,t,s={},i=Ze){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var At;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(At||(At={}));class ve{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ve.syncState(this.state,i,n,a),this.pendingDiffs.forEach(c=>{this.state=ve.syncDiff(this.state,c,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ve.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(n,(l,d)=>{a[l]||(c[l]=d)}),this.map(a,(l,d)=>{const f=n[l];if(f){const u=d.map(p=>p.presence_ref),h=f.map(p=>p.presence_ref),m=d.filter(p=>h.indexOf(p.presence_ref)<0),g=f.filter(p=>u.indexOf(p.presence_ref)<0);m.length>0&&(o[l]=m),g.length>0&&(c[l]=g)}else o[l]=d}),this.syncDiff(n,{joins:o,leaves:c},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(o,c)=>{var l;const d=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),d.length>0){const f=e[o].map(h=>h.presence_ref),u=d.filter(h=>f.indexOf(h.presence_ref)<0);e[o].unshift(...u)}s(o,d,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const d=c.map(f=>f.presence_ref);l=l.filter(f=>d.indexOf(f.presence_ref)<0),e[o]=l,i(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ct;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ct||(Ct={}));var ye;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(ye||(ye={}));var H;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(H||(H={}));class ft{constructor(e,t={config:{}},s){var i,n;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=x.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ze(this,z.join,this.params,this.timeout),this.rejoinTimer=new Us(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=x.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=x.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this._on(z.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new ve(this),this.broadcastEndpointURL=Ls(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((n=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||n===void 0)&&n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==x.closed){const{config:{broadcast:a,presence:o,private:c}}=this.params,l=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(h=>h.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[ye.PRESENCE]&&this.bindings[ye.PRESENCE].length>0||((n=this.params.config.presence)===null||n===void 0?void 0:n.enabled)===!0,f={},u={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:l,private:c};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(h=>e==null?void 0:e(H.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(H.CLOSED)),this.updateJoinPayload(Object.assign({config:u},f)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var m;if(this.socket.setAuth(),h===void 0){e==null||e(H.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,p=(m=g==null?void 0:g.length)!==null&&m!==void 0?m:0,v=[];for(let b=0;b<p;b++){const y=g[b],{filter:{event:E,schema:O,table:k,filter:A}}=y,R=h&&h[b];if(R&&R.event===E&&R.schema===O&&R.table===k&&R.filter===A)v.push(Object.assign(Object.assign({},y),{id:R.id}));else{this.unsubscribe(),this.state=x.errored,e==null||e(H.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(H.SUBSCRIBED);return}}).receive("error",h=>{this.state=x.errored,e==null||e(H.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(H.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===x.joined&&e===ye.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var i;const n=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:n,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(i=s.timeout)!==null&&i!==void 0?i:this.timeout);if(o.status===202)return{success:!0};let c=o.statusText;try{const l=await o.json();c=l.error||l.message||c}catch{}return Promise.reject(new Error(c))}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:n,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=l.body)===null||i===void 0?void 0:i.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&n("ok"),l.receive("ok",()=>n("ok")),l.receive("error",()=>n("error")),l.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=x.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(z.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new ze(this,z.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=x.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new ze(this,e,t,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>br){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:d}=z;if(s&&[o,c,l,d].indexOf(a)>=0&&s!==this._joinRef())return;let u=this._onMessage(a,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(h=>{var m,g,p;return((m=h.filter)===null||m===void 0?void 0:m.event)==="*"||((p=(g=h.filter)===null||g===void 0?void 0:g.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===a}).map(h=>h.callback(u,s)):(n=this.bindings[a])===null||n===void 0||n.filter(h=>{var m,g,p,v,b,y;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in h){const E=h.id,O=(m=h.filter)===null||m===void 0?void 0:m.event;return E&&((g=t.ids)===null||g===void 0?void 0:g.includes(E))&&(O==="*"||(O==null?void 0:O.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const E=(b=(v=h==null?void 0:h.filter)===null||v===void 0?void 0:v.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return E==="*"||E===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===a}).map(h=>{if(typeof u=="object"&&"ids"in u){const m=u.data,{schema:g,table:p,commit_timestamp:v,type:b,errors:y}=m;u=Object.assign(Object.assign({},{schema:g,table:p,commit_timestamp:v,eventType:b,new:{},old:{},errors:y}),this._getPayloadRecords(m))}h.callback(u,s)})}_isClosed(){return this.state===x.closed}_isJoined(){return this.state===x.joined}_isJoining(){return this.state===x.joining}_isLeaving(){return this.state===x.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&ft.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(z.close,{},e)}_onError(e){this._on(z.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=x.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Rt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Rt(e.columns,e.old_record)),t}}const Me=()=>{},Ce={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Tr=[1e3,2e3,5e3,1e4],Rr=1e4,Ar=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Cr{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ze,this.transport=null,this.heartbeatIntervalMs=Ce.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Me,this.ref=0,this.reconnectTimer=null,this.vsn=Tt,this.logger=Me,this.conn=null,this.sendBuffer=[],this.serializer=new _r,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${et.websocket}`,this.httpEndpoint=Ls(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=pr.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Z.connecting:return ee.Connecting;case Z.open:return ee.Open;case Z.closing:return ee.Closing;default:return ee.Closed}}isConnected(){return this.connectionState()===ee.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===s);if(i)return i;{const n=new ft(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(yr,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ce.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:i,payload:n,ref:a}=t,o=a?`(${a})`:"",c=n.status||"";this.log("receive",`${c} ${s} ${i} ${o}`.trim(),n),this.channels.filter(l=>l._isMember(s)).forEach(l=>l._trigger(i,n,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Z.open||this.conn.readyState===Z.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(z.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ar],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:gr};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(z.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Us(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ce.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,i,n,a,o,c,l,d,f,u,h;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:Ze,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:Ce.HEARTBEAT_INTERVAL,this.worker=(n=e==null?void 0:e.worker)!==null&&n!==void 0?n:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:Me,this.vsn=(c=e==null?void 0:e.vsn)!==null&&c!==void 0?c:Tt,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:m=>Tr[m-1]||Rr,this.vsn){case Ns:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,g)=>g(JSON.stringify(m)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(m,g)=>g(JSON.parse(m));break;case vr:this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:this.serializer.encode.bind(this.serializer),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class pt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function P(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Pr extends pt{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class st extends pt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const mt=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Ir=()=>Response,rt=r=>{if(Array.isArray(r))return r.map(t=>rt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=rt(s)}),e},xr=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Fe=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},$r=(r,e,t)=>_(void 0,void 0,void 0,function*(){const s=yield Ir();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(i=>{const n=r.status||500,a=(i==null?void 0:i.statusCode)||n+"";e(new Pr(Fe(i),n,a))}).catch(i=>{e(new st(Fe(i),i))}):e(new st(Fe(r),r))}),Nr=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!s?i:(xr(s)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s)):i.body=s,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function Ee(r,e,t,s,i,n){return _(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Nr(e,s,i,n)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>$r(c,o,s))})})}function be(r,e,t,s){return _(this,void 0,void 0,function*(){return Ee(r,"GET",e,t,s)})}function V(r,e,t,s,i){return _(this,void 0,void 0,function*(){return Ee(r,"POST",e,s,i,t)})}function it(r,e,t,s,i){return _(this,void 0,void 0,function*(){return Ee(r,"PUT",e,s,i,t)})}function Ur(r,e,t,s){return _(this,void 0,void 0,function*(){return Ee(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function gt(r,e,t,s,i){return _(this,void 0,void 0,function*(){return Ee(r,"DELETE",e,s,i,t)})}class qr{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return _(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(P(e))return{data:null,error:e};throw e}})}}var Ds;class Lr{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ds]="BlobDownloadBuilder",this.promise=null}asStream(){return new qr(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return _(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(P(e))return{data:null,error:e};throw e}})}}Ds=Symbol.toStringTag;const Dr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Pt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Br{constructor(e,t={},s,i){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=mt(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,i){return _(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Pt),i);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),c&&n.append("metadata",this.encodeMetadata(c)),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.has("cacheControl")||n.append("cacheControl",a.cacheControl),c&&!n.has("metadata")&&n.append("metadata",this.encodeMetadata(c))):(n=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&n instanceof ReadableStream||n&&typeof n=="object"&&"pipe"in n&&typeof n.pipe=="function")&&!a.duplex&&(a.duplex="half")),i!=null&&i.headers&&(o=Object.assign(Object.assign({},o),i.headers));const l=this._removeEmptyFolders(t),d=this._getFinalPath(l),f=yield(e=="PUT"?it:V)(this.fetch,`${this.url}/object/${d}`,n,Object.assign({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:l,id:f.Id,fullPath:f.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(P(n))return{data:null,error:n};throw n}})}upload(e,t,s){return _(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return _(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Pt.upsert},i),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,d["cache-control"]=`max-age=${l.cacheControl}`,d["content-type"]=l.contentType);const f=yield it(this.fetch,o.toString(),c,{headers:d});return{data:{path:n,fullPath:f.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(P(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return _(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const n=yield V(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),a=new URL(this.url+n.url),o=a.searchParams.get("token");if(!o)throw new pt("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(P(s))return{data:null,error:s};throw s}})}update(e,t,s){return _(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return _(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(P(i))return{data:null,error:i};throw i}})}copy(e,t,s){return _(this,void 0,void 0,function*(){try{return{data:{path:(yield V(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(P(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return _(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield V(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(P(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return _(this,void 0,void 0,function*(){try{const i=yield V(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(P(i))return{data:null,error:i};throw i}})}download(e,t){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"",o=this._getFinalPath(e),c=()=>be(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new Lr(c,this.shouldThrowOnError)}info(e){return _(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield be(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:rt(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(P(s))return{data:null,error:s};throw s}})}exists(e){return _(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ur(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(P(s)&&s instanceof st){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&i.push(c);let l=i.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return _(this,void 0,void 0,function*(){try{return{data:yield gt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}list(e,t,s){return _(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Dr),t),{prefix:e||""});return{data:yield V(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(P(i))return{data:null,error:i};throw i}})}listV2(e,t){return _(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield V(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(P(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Bs="2.81.1",zs={"X-Client-Info":`storage-js/${Bs}`};class zr{constructor(e,t={},s,i){this.shouldThrowOnError=!1;const n=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zs),t),this.fetch=mt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return _(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield be(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}getBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}createBucket(e){return _(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield V(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(P(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return _(this,void 0,void 0,function*(){try{return{data:yield it(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(P(s))return{data:null,error:s};throw s}})}emptyBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield gt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class Mr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zs),t),this.fetch=mt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}listBuckets(e){return _(this,void 0,void 0,function*(){try{const t=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&t.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&t.set("sortOrder",e.sortOrder),e!=null&&e.search&&t.set("search",e.search);const s=t.toString(),i=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield be(this.fetch,i,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield gt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(P(t))return{data:null,error:t};throw t}})}}const vt={"X-Client-Info":`storage-js/${Bs}`,"Content-Type":"application/json"};class Ms extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function q(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}class Ve extends Ms{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Fr extends Ms{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var It;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(It||(It={}));const yt=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Vr=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},xt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Wr=(r,e,t)=>_(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(t!=null&&t.noResolveJson)){const i=r.status||500,n=r;if(typeof n.json=="function")n.json().then(a=>{const o=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||i+"";e(new Ve(xt(a),i,o))}).catch(()=>{const a=i+"",o=n.statusText||`HTTP ${i} error`;e(new Ve(o,i,a))});else{const a=i+"",o=n.statusText||`HTTP ${i} error`;e(new Ve(o,i,a))}}else e(new Fr(xt(r),r))}),Hr=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return s?(Vr(s)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s)):i.body=s,Object.assign(Object.assign({},i),t)):i};function Kr(r,e,t,s,i,n){return _(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Hr(e,s,i,n)).then(c=>{if(!c.ok)throw c;if(s!=null&&s.noResolveJson)return c;const l=c.headers.get("content-type");return!l||!l.includes("application/json")?{}:c.json()}).then(c=>a(c)).catch(c=>Wr(c,o,s))})})}function L(r,e,t,s,i){return _(this,void 0,void 0,function*(){return Kr(r,"POST",e,s,i,t)})}class Jr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},vt),t),this.fetch=yt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return _(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}getIndex(e,t){return _(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(q(s))return{data:null,error:s};throw s}})}listIndexes(e){return _(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return _(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(q(s))return{data:null,error:s};throw s}})}}class Gr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},vt),t),this.fetch=yt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return _(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield L(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}getVectors(e){return _(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}listVectors(e){return _(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield L(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}queryVectors(e){return _(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}deleteVectors(e){return _(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield L(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}}class Yr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},vt),t),this.fetch=yt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return _(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}getBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}listBuckets(){return _(this,arguments,void 0,function*(e={}){try{return{data:yield L(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(q(t))return{data:null,error:t};throw t}})}}class Qr extends Yr{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Xr(this.url,this.headers,e,this.fetch)}}class Xr extends Jr{constructor(e,t,s,i){super(e,t,i),this.vectorBucketName=s}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return _(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return _(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return _(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return _(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Zr(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Zr extends Gr{constructor(e,t,s,i,n){super(e,t,n),this.vectorBucketName=s,this.indexName=i}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return _(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return _(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return _(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return _(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return _(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class ei extends zr{constructor(e,t={},s,i){super(e,t,s,i)}from(e){return new Br(this.url,this.headers,e,this.fetch)}get vectors(){return new Qr(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Mr(this.url+"/iceberg",this.headers,this.fetch)}}const ti="2.81.1";let ge="";typeof Deno<"u"?ge="deno":typeof document<"u"?ge="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ge="react-native":ge="node";const si={"X-Client-Info":`supabase-js-${ge}/${ti}`},ri={headers:si},ii={schema:"public"},ni={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ai={},oi=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),ci=()=>Headers,li=(r,e,t)=>{const s=oi(t),i=ci();return async(n,a)=>{var o;const c=(o=await e())!==null&&o!==void 0?o:r;let l=new i(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(n,Object.assign(Object.assign({},a),{headers:l}))}};function di(r){return r.endsWith("/")?r:r+"/"}function ui(r,e){var t,s;const{db:i,auth:n,realtime:a,global:o}=r,{db:c,auth:l,realtime:d,global:f}=e,u={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},d),a),storage:{},global:Object.assign(Object.assign(Object.assign({},f),o),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(s=o==null?void 0:o.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?u.accessToken=r.accessToken:delete u.accessToken,u}function hi(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(di(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Fs="2.81.1",ce=30*1e3,nt=3,We=nt*ce,fi="http://localhost:9999",pi="supabase.auth.token",mi={"X-Client-Info":`gotrue-js/${Fs}`},at="X-Supabase-Api-Version",Vs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},gi=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vi=10*60*1e3;class _e extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function w(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class yi extends _e{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function bi(r){return w(r)&&r.name==="AuthApiError"}class te extends _e{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class G extends _e{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class M extends G{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function _i(r){return w(r)&&r.name==="AuthSessionMissingError"}class re extends G{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Pe extends G{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ie extends G{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function wi(r){return w(r)&&r.name==="AuthImplicitGrantRedirectError"}class $t extends G{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ot extends G{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function He(r){return w(r)&&r.name==="AuthRetryableFetchError"}class Nt extends G{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class ct extends G{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ut=` 	
\r=`.split(""),Ei=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Ut.length;e+=1)r[Ut[e].charCodeAt(0)]=-2;for(let e=0;e<Ne.length;e+=1)r[Ne[e].charCodeAt(0)]=e;return r})();function qt(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Ne[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Ne[s]),e.queuedBits-=6}}function Ws(r,e,t){const s=Ei[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Lt(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=a=>{Oi(a,s,t)};for(let a=0;a<r.length;a+=1)Ws(r.charCodeAt(a),i,n);return e.join("")}function Si(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function ki(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}Si(s,e)}}function Oi(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function de(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Ws(r.charCodeAt(i),t,s);return new Uint8Array(e)}function ji(r){const e=[];return ki(r,t=>e.push(t)),new Uint8Array(e)}function se(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return r.forEach(i=>qt(i,t,s)),qt(null,t,s),e.join("")}function Ti(r){return Math.round(Date.now()/1e3)+r}function Ri(){return Symbol("auth-callback")}const $=()=>typeof window<"u"&&typeof document<"u",Y={tested:!1,writable:!1},Hs=()=>{if(!$())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Y.tested)return Y.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Y.tested=!0,Y.writable=!0}catch{Y.tested=!0,Y.writable=!1}return Y.writable};function Ai(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const Ks=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Ci=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",le=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Q=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},K=async(r,e)=>{await r.removeItem(e)};class De{constructor(){this.promise=new De.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}De.promiseConstructor=Promise;function Ke(r){const e=r.split(".");if(e.length!==3)throw new ct("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!gi.test(e[s]))throw new ct("JWT not in base64url format");return{header:JSON.parse(Lt(e[0])),payload:JSON.parse(Lt(e[1])),signature:de(e[2]),raw:{header:e[0],payload:e[1]}}}async function Pi(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Ii(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){s(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function xi(r){return("0"+r.toString(16)).substr(-2)}function $i(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,xi).join("")}async function Ni(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function Ui(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Ni(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ie(r,e,t=!1){const s=$i();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await le(r,`${e}-code-verifier`,i);const n=await Ui(s);return[n,s===n?"plain":"s256"]}const qi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Li(r){const e=r.headers.get(at);if(!e||!e.match(qi))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Di(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Bi(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const zi=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ne(r){if(!zi.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Je(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Mi(r,e){return new Proxy(r,{get:(t,s,i)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const n=s.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)"||n==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,i)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,i)}})}function Dt(r){return JSON.parse(JSON.stringify(r))}const X=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Fi=[502,503,504];async function Bt(r){var e;if(!Ci(r))throw new ot(X(r),0);if(Fi.includes(r.status))throw new ot(X(r),r.status);let t;try{t=await r.json()}catch(n){throw new te(X(n),n)}let s;const i=Li(r);if(i&&i.getTime()>=Vs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Nt(X(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new M}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new Nt(X(t),r.status,t.weak_password.reasons);throw new yi(X(t),r.status||500,s)}const Vi=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function S(r,e,t,s){var i;const n=Object.assign({},s==null?void 0:s.headers);n[at]||(n[at]=Vs["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const a=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Wi(r,e,t+o,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Wi(r,e,t,s,i,n){const a=Vi(e,s,i,n);let o;try{o=await r(t,Object.assign({},a))}catch(c){throw console.error(c),new ot(X(c),0)}if(o.ok||await Bt(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await Bt(c)}}function F(r){var e;let t=null;Ji(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Ti(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function zt(r){const e=F(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function J(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Hi(r){return{data:r,error:null}}function Ki(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,a=he(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Mt(r){return r}function Ji(r){return r.access_token&&r.refresh_token&&r.expires_in}const Ge=["global","local","others"];class Gi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Ks(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Ge[0]){if(Ge.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ge.join(", ")}`);try{return await S(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(w(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await S(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:J})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=he(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await S(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Ki,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(w(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await S(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:J})}catch(t){if(w(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},d=await S(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:Mt});if(d.error)throw d.error;const f=await d.json(),u=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(c=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return h.length>0&&(h.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(m.split(";")[1].split("=")[1]);l[`${p}Page`]=g}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},f),l),error:null}}catch(l){if(w(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){ne(e);try{return await S(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:J})}catch(t){if(w(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ne(e);try{return await S(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:J})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){ne(e);try{return await S(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:J})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){ne(e.userId);try{const{data:t,error:s}=await S(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(w(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ne(e.userId),ne(e.id);try{return{data:await S(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(w(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,i,n,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},d=await S(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:Mt});if(d.error)throw d.error;const f=await d.json(),u=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(c=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return h.length>0&&(h.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(m.split(";")[1].split("=")[1]);l[`${p}Page`]=g}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},f),l),error:null}}catch(l){if(w(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await S(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await S(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await S(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(w(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await S(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(w(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await S(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(w(t))return{data:null,error:t};throw t}}}function Ft(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const ae={debug:!!(globalThis&&Hs()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Js extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Yi extends Js{}async function Qi(r,e,t){ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ae.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Yi(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(ae.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function Xi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Gs(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function Zi(r){return parseInt(r,16)}function en(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function tn(r){var e;const{chainId:t,domain:s,expirationTime:i,issuedAt:n=new Date,nonce:a,notBefore:o,requestId:c,resources:l,scheme:d,uri:f,version:u}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(u!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${u}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const h=Gs(r.address),m=d?`${d}://${s}`:s,g=r.statement?`${r.statement}
`:"",p=`${m} wants you to sign in with your Ethereum account:
${h}

${g}`;let v=`URI: ${f}
Version: ${u}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${n.toISOString()}`;if(i&&(v+=`
Expiration Time: ${i.toISOString()}`),o&&(v+=`
Not Before: ${o.toISOString()}`),c&&(v+=`
Request ID: ${c}`),l){let b=`
Resources:`;for(const y of l){if(!y||typeof y!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${y}`);b+=`
- ${y}`}v+=b}return`${p}
${v}`}class I extends Error{constructor({message:e,code:t,cause:s,name:i}){var n;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(n=i??(s instanceof Error?s.name:void 0))!==null&&n!==void 0?n:"Unknown Error",this.code=t}}class Ue extends I{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function sn({error:r,options:e}){var t,s,i;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new I({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=n.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new I({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=n.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new I({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((i=n.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new I({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new I({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new I({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return n.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new I({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new I({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const a=window.location.hostname;if(Ys(a)){if(n.rp.id!==a)return new I({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new I({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new I({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new I({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new I({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function rn({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new I({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new I({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(Ys(s)){if(t.rpId!==s)return new I({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new I({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new I({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new I({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class nn{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const an=new nn;function on(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:s}=r,i=he(r,["challenge","user","excludeCredentials"]),n=de(e).buffer,a=Object.assign(Object.assign({},t),{id:de(t.id).buffer}),o=Object.assign(Object.assign({},i),{challenge:n,user:a});if(s&&s.length>0){o.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){const l=s[c];o.excludeCredentials[c]=Object.assign(Object.assign({},l),{id:de(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return o}function cn(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,s=he(r,["challenge","allowCredentials"]),i=de(e).buffer,n=Object.assign(Object.assign({},s),{challenge:i});if(t&&t.length>0){n.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){const o=t[a];n.allowCredentials[a]=Object.assign(Object.assign({},o),{id:de(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return n}function ln(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:se(new Uint8Array(r.response.attestationObject)),clientDataJSON:se(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function dn(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,s=r.getClientExtensionResults(),i=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:se(new Uint8Array(i.authenticatorData)),clientDataJSON:se(new Uint8Array(i.clientDataJSON)),signature:se(new Uint8Array(i.signature)),userHandle:i.userHandle?se(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Ys(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Vt(){var r,e;return!!($()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function un(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ue("Browser returned unexpected credential type",e)}:{data:null,error:new Ue("Empty credential response",e)}}catch(e){return{data:null,error:sn({error:e,options:r})}}}async function hn(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ue("Browser returned unexpected credential type",e)}:{data:null,error:new Ue("Empty credential response",e)}}catch(e){return{data:null,error:rn({error:e,options:r})}}}const fn={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},pn={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function qe(...r){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(const i of r)if(i)for(const n in i){const a=i[n];if(a!==void 0)if(Array.isArray(a))s[n]=a;else if(t(a))s[n]=a;else if(e(a)){const o=s[n];e(o)?s[n]=qe(o,a):s[n]=qe(a)}else s[n]=a}return s}function mn(r,e){return qe(fn,r,e||{})}function gn(r,e){return qe(pn,r,e||{})}class vn{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:i},n){try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:o};const c=i??an.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:l}=a.webauthn.credential_options.publicKey;l.name||(l.name=`${l.id}:${s}`),l.displayName||(l.displayName=l.name)}switch(a.webauthn.type){case"create":{const l=mn(a.webauthn.credential_options.publicKey,n==null?void 0:n.create),{data:d,error:f}=await un({publicKey:l,signal:c});return d?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}case"request":{const l=gn(a.webauthn.credential_options.publicKey,n==null?void 0:n.request),{data:d,error:f}=await hn(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:l,signal:c}));return d?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}}}catch(a){return w(a)?{data:null,error:a}:{data:null,error:new te("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!t)return{data:null,error:new _e("rpId is required for WebAuthn authentication")};try{if(!Vt())return{data:null,error:new te("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:i},{request:n});if(!a)return{data:null,error:o};const{webauthn:c}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:s,credential_response:c.credential_response}})}catch(a){return w(a)?{data:null,error:a}:{data:null,error:new te("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!t)return{data:null,error:new _e("rpId is required for WebAuthn registration")};try{if(!Vt())return{data:null,error:new te("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(u=>u.factor_type==="webauthn"&&u.friendly_name===e&&u.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:o};const{data:c,error:l}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:i},{create:n});return c?this._verify({factorId:a.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:l}}catch(a){return w(a)?{data:null,error:a}:{data:null,error:new te("Unexpected error in register",a)}}}}Xi();const yn={url:fi,storageKey:pi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:mi,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Wt(r,e,t){return await t()}const oe={};class we{get jwks(){var e,t;return(t=(e=oe[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){oe[this.storageKey]=Object.assign(Object.assign({},oe[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=oe[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){oe[this.storageKey]=Object.assign(Object.assign({},oe[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},yn),e);if(this.storageKey=n.storageKey,this.instanceID=(t=we.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,we.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.instanceID>0&&$()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Gi({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ks(n.fetch),this.lock=n.lock||Wt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,n.lock?this.lock=n.lock:$()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Qi:this.lock=Wt,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new vn(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Hs()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ft(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Ft(this.memoryStorage)),$()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Fs}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if($()&&(t=Ai(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),$()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),wi(n)){const c=(e=n.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return w(t)?this._returnResult({error:t}):this._returnResult({error:new te("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const n=await S(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:F}),{data:a,error:o}=n;if(o||!a)return this._returnResult({data:{user:null,session:null},error:o});const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:l,session:c},error:null})}catch(n){if(w(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signUp(e){var t,s,i;try{let n;if("email"in e){const{email:d,password:f,options:u}=e;let h=null,m=null;this.flowType==="pkce"&&([h,m]=await ie(this.storage,this.storageKey)),n=await S(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:u==null?void 0:u.emailRedirectTo,body:{email:d,password:f,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:h,code_challenge_method:m},xform:F})}else if("phone"in e){const{phone:d,password:f,options:u}=e;n=await S(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},channel:(i=u==null?void 0:u.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:F})}else throw new Pe("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return this._returnResult({data:{user:null,session:null},error:o});const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:l,session:c},error:null})}catch(n){if(w(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await S(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zt})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await S(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zt})}else throw new Pe("You must provide either an email or phone number and a password");const{data:s,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){const n=new re;return this._returnResult({data:{user:null,session:null},error:n})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(w(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,i,n,a,o,c,l,d,f,u;let h,m;if("message"in e)h=e.message,m=e.signature;else{const{chain:g,wallet:p,statement:v,options:b}=e;let y;if($())if(typeof p=="object")y=p;else{const j=window;if("ethereum"in j&&typeof j.ethereum=="object"&&"request"in j.ethereum&&typeof j.ethereum.request=="function")y=j.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=p}const E=new URL((t=b==null?void 0:b.url)!==null&&t!==void 0?t:window.location.href),O=await y.request({method:"eth_requestAccounts"}).then(j=>j).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!O||O.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=Gs(O[0]);let A=(s=b==null?void 0:b.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!A){const j=await y.request({method:"eth_chainId"});A=Zi(j)}const R={domain:E.host,address:k,statement:v,uri:E.href,version:"1",chainId:A,nonce:(i=b==null?void 0:b.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(a=(n=b==null?void 0:b.signInWithEthereum)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=b==null?void 0:b.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(c=b==null?void 0:b.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(l=b==null?void 0:b.signInWithEthereum)===null||l===void 0?void 0:l.requestId,resources:(d=b==null?void 0:b.signInWithEthereum)===null||d===void 0?void 0:d.resources};h=tn(R),m=await y.request({method:"personal_sign",params:[en(h),k]})}try{const{data:g,error:p}=await S(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:m},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(u=e.options)===null||u===void 0?void 0:u.captchaToken}}:null),xform:F});if(p)throw p;if(!g||!g.session||!g.user){const v=new re;return this._returnResult({data:{user:null,session:null},error:v})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:p})}catch(g){if(w(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var t,s,i,n,a,o,c,l,d,f,u,h;let m,g;if("message"in e)m=e.message,g=e.signature;else{const{chain:p,wallet:v,statement:b,options:y}=e;let E;if($())if(typeof v=="object")E=v;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))E=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=v}const O=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const k=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:O.host,uri:O.href}),b?{statement:b}:null));let A;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")A=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)A=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)m=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),g=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${O.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${O.href}`,`Issued At: ${(i=(s=y==null?void 0:y.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=y==null?void 0:y.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((f=(d=y==null?void 0:y.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...y.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const k=await E.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=k}}try{const{data:p,error:v}=await S(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:se(g)},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:F});if(v)throw v;if(!p||!p.session||!p.user){const b=new re;return this._returnResult({data:{user:null,session:null},error:b})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:v})}catch(p){if(w(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async _exchangeCodeForSession(e){const t=await Q(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:n,error:a}=await S(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:F});if(await K(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!n||!n.session||!n.user){const o=new re;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}catch(n){if(w(n))return this._returnResult({data:{user:null,session:null,redirectType:null},error:n});throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:n,nonce:a}=e,o=await S(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:F}),{data:c,error:l}=o;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!c||!c.session||!c.user){const d=new re;return this._returnResult({data:{user:null,session:null},error:d})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:l})}catch(t){if(w(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,d=null;this.flowType==="pkce"&&([l,d]=await ie(this.storage,this.storageKey));const{error:f}=await S(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:d}=await S(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:d})}throw new Pe("You must provide either an email or phone number.")}catch(o){if(w(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var t,s;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await S(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:F});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:l,session:c},error:null})}catch(i){if(w(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,s,i,n,a;try{let o=null,c=null;this.flowType==="pkce"&&([o,c]=await ie(this.storage,this.storageKey));const l=await S(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:c}),headers:this.headers,xform:Hi});return!((n=l.data)===null||n===void 0)&&n.url&&$()&&!(!((a=e.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(o){if(w(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new M;const{error:i}=await S(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(w(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:a}=await S(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:a,error:o}=await S(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o})}throw new Pe("You must provide either an email or phone number and a type")}catch(t){if(w(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Q(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<We:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const a=await Q(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Je()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=Mi(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{session:null},error:n}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await S(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:J}):await this._useSession(async t=>{var s,i,n;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new M}:await S(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:J})})}catch(t){if(w(t))return _i(t)&&(await this._removeSession(),await K(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new M;const a=i.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await ie(this.storage,this.storageKey));const{data:l,error:d}=await S(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:J});if(d)throw d;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(s){if(w(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new M;const t=Date.now()/1e3;let s=t,i=!0,n=null;const{payload:a}=Ke(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{data:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(t){if(w(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new M;const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(w(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!$())throw new Ie("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ie(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new $t("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ie("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $t("No code detected.");const{data:b,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=e;if(!n||!o||!a||!l)throw new Ie("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(o);let u=d+f;c&&(u=parseInt(c));const h=u-d;h*1e3<=ce&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${f}s`);const m=u-f;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,d);const{data:g,error:p}=await this._getUser(n);if(p)throw p;const v={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:f,expires_at:u,refresh_token:a,token_type:l,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:v,redirectType:e.type},error:null})}catch(s){if(w(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Q(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return this._returnResult({error:n});const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(bi(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await K(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Ri(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await ie(this.storage,this.storageKey,!0));try{return await S(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(w(n))return this._returnResult({data:null,error:n});throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var a,o,c,l,d;const{data:f,error:u}=n;if(u)throw u;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await S(this.fetch,"GET",h,{headers:this.headers,jwt:(d=(l=f.session)===null||l===void 0?void 0:l.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return $()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(w(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:i,data:{session:n}}=t;if(i)throw i;const{options:a,provider:o,token:c,access_token:l,nonce:d}=e,f=await S(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=n==null?void 0:n.access_token)!==null&&s!==void 0?s:void 0,body:{provider:o,id_token:c,access_token:l,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:F}),{data:u,error:h}=f;return h?this._returnResult({data:{user:null,session:null},error:h}):!u||!u.session||!u.user?this._returnResult({data:{user:null,session:null},error:new re}):(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("USER_UPDATED",u.session)),this._returnResult({data:u,error:h}))}catch(i){if(w(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await S(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Ii(async i=>(i>0&&await Pi(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await S(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:F})),(i,n)=>{const a=200*Math.pow(2,i);return n&&He(n)&&Date.now()+a-s<ce})}catch(s){if(this._debug(t,"error",s),w(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),$()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await Q(this.storage,this.storageKey);if(i&&this.userStorage){let a=await Q(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:i.user},await le(this.userStorage,this.storageKey+"-user",a)),i.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Je()}else if(i&&!i.user&&!i.user){const a=await Q(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(i.user=a.user,await K(this.storage,this.storageKey+"-user"),await le(this.storage,this.storageKey,i)):i.user=Je()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const n=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<We;if(this._debug(s,`session has${n?"":" not"} expired with margin of ${We}s`),n){if(this.autoRefreshToken&&i.refresh_token){const{error:a}=await this._callRefreshToken(i.refresh_token);a&&(console.error(a),He(a)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(i.access_token);!o&&(a!=null&&a.user)?(i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new M;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new De;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new M;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={data:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),w(n)){const a={data:null,error:n};return He(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){n.push(c)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await le(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const n=Dt(i);await le(this.storage,this.storageKey,n)}else{const i=Dt(t);await le(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await K(this.storage,this.storageKey),await K(this.storage,this.storageKey+"-code-verifier"),await K(this.storage,this.storageKey+"-user"),this.userStorage&&await K(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&$()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ce);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/ce);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ce}ms, refresh threshold is ${nt} ticks`),i<=nt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Js)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,a]=await ie(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?this._returnResult({data:null,error:n}):await S(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:l}=await S(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(e.factorType==="totp"&&c.type==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ln(e.webauthn.credential_response):dn(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:c}=await S(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:c}))})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});const a=await S(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});if(a.error)return a;const{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:on(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:cn(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const i={all:[],phone:[],totp:[],webauthn:[]};for(const n of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])i.all.push(n),n.status==="verified"&&i[n.factor_type].push(n);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:s},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Ke(s.access_token);let a=null;n.aal&&(a=n.aal);let o=a;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(o="aal2");const l=n.amr||[];return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:l},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:s},error:i}=t;return i?this._returnResult({data:null,error:i}):s?await S(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new M})})}catch(t){if(w(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:i},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new M});const a=await S(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&$()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(s){if(w(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:i},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new M});const a=await S(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&$()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(s){if(w(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+vi>i)return s;const{data:n,error:a}=await S(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=i,s=n.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:h,error:m}=await this.getSession();if(m||!h.session)return this._returnResult({data:null,error:m});s=h.session.access_token}const{header:i,payload:n,signature:a,raw:{header:o,payload:c}}=Ke(s);t!=null&&t.allowExpired||Di(n.exp);const l=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!l){const{error:h}=await this.getUser(s);if(h)throw h;return{data:{claims:n,header:i,signature:a},error:null}}const d=Bi(i.alg),f=await crypto.subtle.importKey("jwk",l,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,a,ji(`${o}.${c}`)))throw new ct("Invalid JWT signature");return{data:{claims:n,header:i,signature:a},error:null}}catch(s){if(w(s))return this._returnResult({data:null,error:s});throw s}}}we.nextInstanceID={};const bn=we;class _n extends bn{constructor(e){super(e)}}class wn{constructor(e,t,s){var i,n,a;this.supabaseUrl=e,this.supabaseKey=t;const o=hi(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const c=`sb-${o.hostname.split(".")[0]}-auth-token`,l={db:ii,realtime:ai,auth:Object.assign(Object.assign({},ni),{storageKey:c}),global:ri},d=ui(s??{},l);this.storageKey=(i=d.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=d.global.headers)!==null&&n!==void 0?n:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=d.auth)!==null&&a!==void 0?a:{},this.headers,d.global.fetch),this.fetch=li(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.accessToken&&this.accessToken().then(f=>this.realtime.setAuth(f)).catch(f=>console.warn("Failed to set initial Realtime auth token:",f)),this.rest=new fr(new URL("rest/v1",o).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new ei(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new lr(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,userStorage:n,storageKey:a,flowType:o,lock:c,debug:l,throwOnError:d},f,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _n({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),f),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,userStorage:n,flowType:o,lock:c,debug:l,throwOnError:d,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Cr(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const En=(r,e,t)=>new wn(r,e,t);function Sn(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Sn()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const kn="https://hkxugotjfkyalmlkojhq.supabase.co",On="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhreHVnb3RqZmt5YWxtbGtvamhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxODk3MTAsImV4cCI6MjA3Nzc2NTcxMH0.mV21rbO4K5gfmYWF_ZB5mcjPG2TLu80w0SOMBCoDkaE",jn=kn,Tn=On,U=En(jn,Tn),Qs=[{codigo:"1.1",pregunta:"Se han identificado el contexto interno y externo que afecta la gestin ambiental del predio (factores sociales, legales, tecnolgicos, educativos, ambientales, etc.)?",queImplica:"El contexto permite comprender las condiciones internas y externas que influyen en la gestin del predio. Incluye aspectos sociales, ambientales, legales, econmicos, tecnolgicos y educativos que pueden afectar su desempeo o cumplimiento de objetivos. Este anlisis ayuda a anticipar riesgos, aprovechar oportunidades y orientar la planificacin de las actividades.",comoCumplir:" Identificar los factores internos (infraestructura, recursos, cultura organizacional, procesos).  Identificar los factores externos (legislacin, comunidad, entorno ambiental, tecnologa, expectativas sociales).  Analizar cmo estos factores pueden afectar el desempeo o el cumplimiento de requisitos.  Revisar y actualizar el anlisis cuando haya cambios importantes en el contexto (nuevas leyes, modificaciones en las actividades o en el entorno).",evidencias:" Documento o matriz de anlisis del contexto.  Actas de reuniones o talleres donde se haya discutido el contexto.  Informes de diagnstico ambiental o institucional.  Planes estratgicos o de desarrollo del predio.  Anlisis DOFA o similar (debilidades, oportunidades, fortalezas y amenazas).",criterios:{1:"1: No se ha realizado ningn anlisis del contexto.",2:"2: Se tiene conocimiento general de los factores, pero no estn documentados.",3:"3: Existe un anlisis parcial o desactualizado.",4:"4: El contexto est identificado, documentado y actualizado.",5:"5: El contexto se revisa peridicamente y se usa para la toma de decisiones y la planificacin del predio."}},{codigo:"1.2",pregunta:"Se han identificado las partes interesadas relevantes para la gestin ambiental (estudiantes, docentes, comunidad, autoridades, proveedores, etc.) y se han determinado sus necesidades y expectativas?",queImplica:"Las partes interesadas son todas aquellas personas, grupos o entidades que pueden influir o verse afectadas por las actividades del predio. Conocer quines son y qu esperan permite planificar mejor las acciones, cumplir requisitos legales y fortalecer la relacin con la comunidad. Este anlisis ayuda a que la gestin sea ms efectiva y responda a las necesidades reales del entorno.",comoCumplir:" Elaborar una lista o matriz con las partes interesadas relevantes del predio.  Determinar las necesidades, expectativas o requisitos de cada parte (por ejemplo: cumplimiento de normas, informacin, seguridad, calidad del servicio, participacin).  Definir acciones o mecanismos para atender esas necesidades (comunicaciones, programas, controles o acuerdos).  Revisar y actualizar la informacin peridicamente, especialmente si cambian las actividades o el entorno del predio).",evidencias:" Matriz de partes interesadas y sus necesidades o expectativas.  Registros de reuniones o comunicaciones con partes interesadas.  Programas o estrategias de participacin y comunicacin.  Encuestas de satisfaccin o informes de gestin social.  Actas de comits, visitas o actividades conjuntas.",criterios:{1:"1: No se han identificado las partes interesadas ni sus necesidades.",2:"2: Se conocen algunas partes interesadas, pero sin registro formal.",3:"3: Existe una lista parcial o desactualizada de partes interesadas.",4:"4: Las partes interesadas estn identificadas, con necesidades documentadas y acciones definidas.",5:"5: La informacin est actualizada, se revisa regularmente y se usa en la planificacin y mejora del predio."}},{codigo:"1.3",pregunta:"Est claramente definido el alcance del sistema integrado de gestin ambiental (por ejemplo: procesos, reas, sedes o unidades incluidas, y exclusiones justificadas)?",queImplica:"El alcance define qu actividades, procesos, reas o servicios estn cubiertos por el sistema integrado de gestin. Debe describir con precisin qu incluye y qu se excluye, explicando las razones, y reflejar la realidad operativa del predio. Un alcance bien definido permite delimitar responsabilidades, facilitar la planificacin y asegurar que todas las actividades relevantes estn bajo control.",comoCumplir:" Documentar los lmites del sistema y las actividades cubiertas.  Indicar qu procesos o sedes forman parte del sistema y cules no, con su justificacin.  Verificar que el alcance corresponda a las funciones reales del predio.  Revisarlo y actualizarlo cuando haya cambios en la estructura, los servicios o las operaciones.  Comunicarlo a todo el personal y a las partes interesadas cuando sea necesario.",evidencias:" Documento o declaracin de alcance del sistema integrado.  Mapa de procesos.  Organigrama institucional.  Manual o poltica del sistema.  Actas de revisin o aprobacin del alcance.",criterios:{1:"1: No se ha definido el alcance.",2:"2: Se tiene una idea general sin documento formal.",3:"3: Existe un alcance parcial o sin justificacin de exclusiones.",4:"4: Alcance documentado, aprobado y coherente con las operaciones del predio.",5:"5: Alcance actualizado, validado y comunicado a todo el personal."}},{codigo:"1.4",pregunta:"Existe un sistema integrado de gestin ambiental implementado, documentado y en funcionamiento en el predio?",queImplica:"El sistema integrado de gestin debe estar establecido de manera formal y operando en la prctica. Esto significa que las actividades, procesos y responsabilidades del predio se desarrollan conforme a procedimientos definidos y que existe evidencia del cumplimiento de los requisitos ambientales. No basta con tener documentos; el sistema debe estar aplicado, controlado y en mejora continua.",comoCumplir:" Definir la estructura del sistema, sus responsables y las interacciones entre los procesos.  Mantener la documentacin actualizada (manuales, procedimientos, registros).  Asegurar que los procedimientos se apliquen en las actividades diarias.  Realizar auditoras o revisiones internas para verificar su cumplimiento.  Promover la participacin del personal y comunicar los resultados del sistema a todos los niveles.",evidencias:" Manual o estructura documental del sistema integrado.  Procedimientos y registros operativos.  Informes de auditora interna o revisin por la direccin.  Actas de comits o reuniones de seguimiento.  Registros de capacitacin o comunicacin institucional sobre el sistema.",criterios:{1:"1: No existe sistema documentado ni evidencia de aplicacin.",2:"2: Existen documentos aislados sin aplicacin sistemtica.",3:"3: El sistema est parcialmente implementado o no se aplica en todas las reas.",4:"4: El sistema est documentado, aplicado y con seguimiento regular.",5:"5: El sistema funciona de forma completa, con mejora continua y comunicacin en todos los niveles."}},{codigo:"2.1",pregunta:"La direccin del predio demuestra liderazgo y compromiso con la gestin ambiental, asegurando la integracin del sistema en las actividades institucionales?",queImplica:"La direccin del predio debe liderar con el ejemplo, impulsar la aplicacin del sistema y garantizar que la gestin ambiental est integrada en todas las actividades. Su compromiso se refleja en la asignacin de recursos, la participacin activa en la planificacin, el seguimiento de los resultados y la comunicacin de la importancia del cumplimiento de las polticas y objetivos. Un liderazgo visible fortalece la cultura institucional y el sentido de responsabilidad en todo el equipo.",comoCumplir:" Participar en reuniones, auditoras o revisiones relacionadas con el sistema.  Promover el cumplimiento de polticas, objetivos y compromisos institucionales.  Asignar recursos humanos, tcnicos y financieros suficientes.  Reconocer las buenas prcticas del personal y fomentar la mejora continua.  Mantener comunicacin constante sobre la importancia de la gestin ambiental en las decisiones del predio.",evidencias:" Actas de reuniones o comits donde participe la direccin.  Comunicaciones o mensajes institucionales de apoyo al sistema.  Informes de gestin o revisin por la direccin.  Registros de asignacin de recursos o aprobaciones de proyectos.  Evidencias de participacin en campaas, inspecciones o auditoras.",criterios:{1:"1: No hay evidencia de liderazgo o participacin de la direccin.",2:"2: La direccin conoce el sistema, pero su participacin es limitada.",3:"3: La direccin participa parcialmente o solo ante situaciones puntuales.",4:"4: La direccin demuestra compromiso constante y apoyo al sistema.",5:"5: La direccin lidera activamente, comunica los avances y promueve la mejora continua."}},{codigo:"2.2",pregunta:"Existe una poltica integrada de gestin ambiental aprobada, actualizada, comunicada y disponible para todas las partes interesadas?",queImplica:"La poltica integrada expresa los compromisos del predio con la proteccin del ambiente, la calidad de sus servicios, el cumplimiento de los requisitos legales y la mejora continua. Debe estar aprobada por la direccin, mantenerse actualizada y ser conocida por todo el personal y las partes interesadas. Esta poltica sirve como gua para las decisiones, objetivos y acciones dentro del sistema de gestin.",comoCumplir:" Elaborar la poltica de forma clara, sencilla y coherente con las actividades del predio.  Aprobarla formalmente por la direccin y difundirla mediante medios accesibles (carteleras, correos, reuniones, capacitaciones o pgina web).  Revisarla peridicamente para verificar que sigue siendo adecuada y actual.  Asegurar que todos los trabajadores comprendan su contenido y cmo aplicarla en su labor diaria.",evidencias:" Documento de la poltica firmada y aprobada.  Publicacin en carteleras, sitio web o material institucional.  Registros de capacitacin o socializacin de la poltica.  Comunicaciones oficiales o correos informativos.  Actas de revisin o actualizacin de la poltica.",criterios:{1:"1: No existe poltica formal ni documento aprobado.",2:"2: Existe un borrador o documento antiguo sin aprobacin ni difusin.",3:"3: La poltica est aprobada, pero no se comunica o no est actualizada.",4:"4: La poltica est vigente, aprobada y comunicada al personal del predio.",5:"5: La poltica est actualizada, publicada, comprendida y aplicada por todo el personal y las partes interesadas."}},{codigo:"2.3",pregunta:"Estn definidos, documentados y comunicados los roles, responsabilidades y autoridades del personal del predio (administradores, docentes, operarios) dentro del sistema integrado de gestin ambiental?",queImplica:"La definicin clara de roles y responsabilidades garantiza que cada persona conozca sus funciones dentro del sistema integrado. Esto evita confusiones, facilita la ejecucin de las tareas y asegura que las actividades relacionadas con la gestin ambiental se realicen correctamente. Adems, la autoridad asignada debe ser coherente con las responsabilidades y con el nivel de decisin que cada cargo requiere.",comoCumplir:" Definir las funciones y responsabilidades en documentos formales (manuales, descripciones de cargo o procedimientos).  Comunicar y capacitar al personal sobre su papel dentro del sistema.  Verificar que las autoridades asignadas sean adecuadas para cumplir las tareas.  Actualizar las funciones cuando cambien las estructuras o procesos del predio.  Asegurar que todas las reas estn representadas en el sistema.",evidencias:" Manual de funciones o perfiles de cargo.  Organigrama institucional o del sistema integrado.  Actas o comunicaciones donde se asignen responsabilidades.  Procedimientos que indiquen responsables por actividad.  Registros de capacitaciones o reuniones informativas.",criterios:{1:"1: No existen roles ni responsabilidades definidos.",2:"2: Las funciones existen de manera informal o sin documentacin.",3:"3: Los roles estn definidos pero no comunicados o actualizados.",4:"4: Roles, responsabilidades y autoridades estn documentados, comunicados y aplicados.",5:"5: Roles claramente definidos, revisados peridicamente y comprendidos por todo el personal."}},{codigo:"3.1.1",pregunta:"El predio ha identificado los riesgos y oportunidades que pueden afectar la gestin ambiental, la calidad del servicio y el cumplimiento de los objetivos institucionales?",queImplica:"La identificacin de riesgos y oportunidades permite anticipar situaciones que podran impactar negativa o positivamente la gestin ambiental y la calidad de los servicios. Este anlisis ayuda a planificar acciones preventivas, mejorar la eficiencia y fortalecer el cumplimiento de los objetivos institucionales. Debe contemplar factores internos (operativos, administrativos, de recursos) y externos (sociales, legales, ambientales, tecnolgicos).",comoCumplir:" Realizar una evaluacin sistemtica de riesgos y oportunidades utilizando mtodos adecuados (matrices, listas de verificacin o anlisis FODA).  Involucrar a las diferentes reas del predio en la identificacin de situaciones que afecten sus procesos.  Definir responsables para el seguimiento de las acciones preventivas y de mejora.  Revisar peridicamente los resultados para actualizar la informacin y ajustar las medidas segn los cambios del entorno o la operacin.",evidencias:" Matriz de riesgos y oportunidades del sistema integrado.  Registros de reuniones o talleres de anlisis.  Informes de revisin por la direccin.  Planes de accin o controles implementados.  Evidencias del seguimiento de riesgos (indicadores, auditoras o reportes).",criterios:{1:"1: No se han identificado riesgos ni oportunidades.",2:"2: Se han identificado parcialmente sin metodologa ni seguimiento.",3:"3: Existen registros bsicos, pero no se actualizan ni se vinculan con los objetivos.",4:"4: Riesgos y oportunidades estn documentados, evaluados y con planes de accin definidos.",5:"5: El anlisis se revisa, actualiza y se utiliza activamente para la toma de decisiones y mejora continua."}},{codigo:"3.1.2",pregunta:"Se han identificado, evaluado y actualizado los aspectos ambientales y los procesos o actividades que impactan el desempeo ambiental o la calidad de los servicios del predio?",queImplica:"La identificacin de aspectos ambientales y de los procesos que influyen en la calidad permite reconocer cmo las actividades del predio afectan su desempeo ambiental y los resultados de sus servicios. Este anlisis es clave para controlar impactos negativos, aprovechar oportunidades de mejora y cumplir con los objetivos del sistema. Debe actualizarse cuando cambian las operaciones, equipos o condiciones del entorno.",comoCumplir:" Elaborar un inventario de aspectos ambientales asociados a las actividades del predio (uso de recursos, generacin de residuos, emisiones, consumo de energa, etc.).  Evaluar su significancia considerando criterios como frecuencia, severidad, magnitud y capacidad de control.  Identificar tambin los procesos que influyen directamente en la calidad de los servicios ofrecidos.  Mantener la informacin actualizada y revisar los resultados peridicamente.",evidencias:" Matriz de aspectos e impactos ambientales actualizada.  Registro de procesos crticos relacionados con la calidad.  Procedimientos o instructivos de evaluacin.  Informes de revisin o seguimiento.  Actas de reuniones donde se aprueban actualizaciones o cambios.",criterios:{1:"1: No se han identificado aspectos ni procesos significativos.",2:"2: Identificacin parcial o sin criterios claros de evaluacin.",3:"3: Aspectos y procesos identificados, pero sin actualizacin ni seguimiento.",4:"4: Evaluacin completa y actualizada, con criterios documentados y responsables definidos.",5:"5: Sistema consolidado y revisado regularmente, con evidencias de control, mejora y comunicacin al personal."}},{codigo:"3.1.3",pregunta:"Se han determinado, actualizado y comunicado los requisitos legales, normativos y otros requisitos aplicables a la gestin ambiental?",queImplica:"El cumplimiento de los requisitos legales y normativos es esencial para garantizar que las actividades del predio se desarrollen dentro del marco regulatorio vigente. Este proceso implica identificar, evaluar, actualizar y comunicar todas las leyes, decretos, normas tcnicas y compromisos voluntarios que afecten la gestin ambiental y la calidad de los servicios.",comoCumplir:" Establecer un procedimiento para la identificacin y actualizacin de los requisitos legales y otros compromisos aplicables.  Asignar responsables para el seguimiento de cambios normativos y mantener un registro actualizado.  Verificar el cumplimiento mediante auditoras internas o revisiones peridicas.  Asegurar que las reas involucradas conozcan las obligaciones que les corresponden.",evidencias:" Matriz de requisitos legales y normativos vigente.  Registros de actualizacin normativa.  Actas o comunicaciones de socializacin de cambios legales.  Informes de evaluacin del cumplimiento.  Procedimiento documentado de identificacin y seguimiento legal.",criterios:{1:"1: No se han identificado requisitos legales o normativos aplicables.",2:"2: Existen referencias parciales o sin actualizacin.",3:"3: Se tiene una matriz o registro, pero sin evidencia de comunicacin ni seguimiento.",4:"4: Los requisitos estn identificados, actualizados y comunicados a las reas pertinentes.",5:"5: Sistema formal de gestin legal implementado, con revisin peridica y evidencia de cumplimiento continuo."}},{codigo:"3.1.4",pregunta:"Se han definido e implementado acciones para abordar los riesgos, oportunidades y aspectos significativos identificados en el sistema integrado de gestin ambiental?",queImplica:"Una vez identificados los riesgos, oportunidades y aspectos significativos, el predio debe planificar e implementar acciones que permitan prevenir efectos negativos, aprovechar oportunidades de mejora y fortalecer la gestin ambiental. Estas acciones deben integrarse en los procesos operativos, ser coherentes con los objetivos institucionales y evaluarse en trminos de eficacia.",comoCumplir:" Establecer planes de accin especficos con responsables, recursos y plazos definidos, priorizando segn nivel de riesgo o significancia.  Incluir medidas preventivas, correctivas y de mejora continua.  Hacer seguimiento a la ejecucin y evaluar los resultados para asegurar que las acciones sean eficaces y sostenibles.  Comunicar los avances a las partes involucradas.",evidencias:" Planes de accin documentados y aprobados.  Registros de seguimiento o evaluacin de las acciones.  Informes de revisin por la direccin.  Evidencias de implementacin (fotografas, actas, reportes).  Indicadores de cumplimiento o mejora.",criterios:{1:"1: No se han definido acciones para abordar riesgos u oportunidades.",2:"2: Existen acciones identificadas, pero sin planificacin ni seguimiento.",3:"3: Hay planes definidos, pero sin evidencia clara de implementacin o resultados.",4:"4: Las acciones estn implementadas, documentadas y con seguimiento parcial.",5:"5: Las acciones estn completamente integradas, evaluadas y evidencian mejoras sostenibles."}},{codigo:"3.2.1",pregunta:"Existen objetivos de gestin ambiental documentados, medibles y coherentes con la poltica institucional?",queImplica:"Los objetivos permiten orientar los esfuerzos del predio hacia la mejora del desempeo ambiental y de la calidad de los servicios. Deben ser claros, medibles, alcanzables, relevantes y coherentes con la poltica institucional. Su formulacin y seguimiento garantizan que el sistema de gestin se traduzca en resultados concretos y verificables.",comoCumplir:" Definir objetivos especficos para las reas ms relevantes del predio (por ejemplo: reduccin de consumo de agua, mejora en la satisfaccin de usuarios, control de residuos).  Establecer indicadores que permitan medir el avance.  Asegurar que los objetivos estn documentados, aprobados por la direccin y comunicados a todo el personal.  Revisarlos peridicamente y actualizarlos segn los resultados o cambios en las condiciones operativas.",evidencias:" Listado o matriz de objetivos ambientales.  Indicadores de seguimiento y resultados.  Actas de aprobacin por la direccin.  Informes de cumplimiento.  Evidencias de comunicacin o difusin de los objetivos.",criterios:{1:"1: No existen objetivos definidos.",2:"2: Existen objetivos generales, pero no son medibles ni documentados.",3:"3: Objetivos definidos, pero sin indicadores o sin seguimiento formal.",4:"4: Objetivos documentados, medibles y con evidencia de seguimiento.",5:"5: Objetivos revisados peridicamente, alcanzados o ajustados segn resultados, alineados con la poltica institucional."}},{codigo:"3.2.2",pregunta:"Se han establecido y ejecutado planes de accin con responsables, recursos y plazos para cumplir los objetivos de gestin ambiental?",queImplica:"Los planes de accin son la herramienta que convierte los objetivos en actividades concretas y medibles. Permiten organizar los recursos, asignar responsabilidades y definir plazos para alcanzar los resultados esperados en la gestin ambiental. Su correcta ejecucin garantiza que los compromisos institucionales se traduzcan en mejoras reales dentro del predio.",comoCumplir:" Elaborar planes de accin para cada objetivo definido, incluyendo actividades especficas, responsables, cronogramas, recursos requeridos y mtodos de evaluacin.  Hacer seguimiento al cumplimiento de cada accin y actualizar los planes segn los resultados obtenidos o las condiciones operativas.  Asegurar la participacin del personal responsable y la comunicacin de los avances a la direccin.",evidencias:" Planes de accin documentados y aprobados.  Registros de seguimiento o cumplimiento.  Informes de avance y resultados.  Actas de reuniones de seguimiento.  Indicadores asociados a los objetivos.  Evidencia de uso de recursos y asignacin de responsables.",criterios:{1:"1: No existen planes de accin definidos.",2:"2: Planes elaborados parcialmente o sin responsables claros.",3:"3: Planes definidos, pero sin evidencia de ejecucin o seguimiento.",4:"4: Planes ejecutados con registros de cumplimiento y revisin.",5:"5: Planes actualizados, ejecutados en su totalidad y evaluados por la direccin, con resultados documentados y mejoras demostrables."}},{codigo:"4.1",pregunta:"El predio cuenta con los recursos humanos, tcnicos, financieros e infraestructura necesarios para la gestin ambiental?",queImplica:"Disponer de los recursos adecuados es fundamental para garantizar el funcionamiento efectivo del sistema de gestin ambiental. Esto incluye contar con personal suficiente y competente, infraestructura en buenas condiciones, equipos funcionales y recursos financieros que permitan ejecutar las actividades planificadas y cumplir los objetivos establecidos.",comoCumplir:" Identificar las necesidades de recursos segn los procesos del predio y planificarlas dentro del presupuesto institucional.  Asegurar que los equipos, herramientas e instalaciones estn disponibles, mantenidos y en condiciones ptimas.  Asignar personal suficiente y capacitado para ejecutar las tareas del sistema.  Revisar peridicamente la disponibilidad de recursos y gestionar ajustes cuando sea necesario.",evidencias:" Plan de recursos o presupuesto anual.  Registros de mantenimiento y calibracin de equipos.  Inventarios de infraestructura y herramientas.  Actas de asignacin de recursos.  Informes de revisin por la direccin.  Evidencias fotogrficas o documentales de adecuaciones y mejoras.",criterios:{1:"1: No existen recursos identificados ni disponibles.",2:"2: Se dispone de algunos recursos, pero son insuficientes o inadecuados.",3:"3: Recursos definidos, pero con limitaciones de disponibilidad o mantenimiento.",4:"4: Recursos suficientes, asignados y utilizados de forma adecuada.",5:"5: Recursos plenamente disponibles, gestionados eficientemente y revisados peridicamente para garantizar la mejora continua."}},{codigo:"4.2",pregunta:"El personal cuenta con las competencias, conocimientos y capacitaciones necesarias para realizar sus funciones relacionadas con la gestin ambiental?",queImplica:"La competencia del personal es un elemento clave para asegurar la correcta implementacin y mantenimiento del sistema de gestin ambiental. Implica que cada persona conozca sus funciones, cuente con la formacin adecuada y posea las habilidades necesarias para cumplir con los requisitos del sistema y los objetivos institucionales.",comoCumplir:" Definir las competencias requeridas para cada cargo o funcin vinculada al sistema.  Evaluar peridicamente el nivel de conocimiento del personal y las necesidades de capacitacin.  Desarrollar programas de formacin y sensibilizacin sobre temas ambientales, seguridad y mejora continua.  Registrar la participacin en capacitaciones y verificar la aplicacin prctica de lo aprendido en las actividades cotidianas.",evidencias:" Matriz de competencias del personal.  Registros de asistencia a capacitaciones y evaluaciones.  Plan anual de formacin.  Manual de funciones o perfiles de cargo.  Actas de reuniones o talleres.  Certificados de cursos o entrenamientos realizados.",criterios:{1:"1: No se han definido competencias ni realizado capacitaciones.",2:"2: Competencias identificadas parcialmente o sin registros de formacin.",3:"3: Existen capacitaciones puntuales, pero sin evaluacin ni seguimiento.",4:"4: Competencias definidas y formacin planificada, con evidencia de aplicacin.",5:"5: Sistema de formacin y evaluacin consolidado, actualizado y alineado con los objetivos del sistema."}},{codigo:"4.3",pregunta:"Se promueve la concientizacin y sensibilizacin sobre la gestin ambiental entre estudiantes, docentes y trabajadores?",queImplica:"La concientizacin y sensibilizacin fortalecen la cultura institucional hacia la sostenibilidad, la calidad y la mejora continua. Implica que toda la comunidad del predio no solo el personal responsable del sistema conozca la importancia de su participacin en la gestin ambiental, comprendiendo cmo sus acciones contribuyen al cumplimiento de los objetivos institucionales y a la proteccin del entorno.",comoCumplir:" Desarrollar campaas, jornadas y actividades educativas que fomenten la responsabilidad ambiental y la mejora del servicio.  Integrar temas de gestin ambiental en las capacitaciones, inducciones y reuniones.  Comunicar de manera accesible los logros, buenas prcticas y resultados del sistema.  Promover la participacin activa de estudiantes, docentes y trabajadores en programas ambientales.",evidencias:" Registros de campaas de sensibilizacin y actividades educativas.  Materiales de comunicacin (afiches, boletines, videos, correos institucionales).  Actas o informes de jornadas ambientales.  Encuestas o evidencias de participacin.  Fotografas y publicaciones en medios institucionales.",criterios:{1:"1: No se realizan actividades de sensibilizacin ni comunicacin.",2:"2: Existen iniciativas aisladas sin continuidad ni registro.",3:"3: Se promueven algunas actividades, pero sin planificacin ni seguimiento.",4:"4: Se realizan campaas y jornadas peridicas, con participacin activa del personal.",5:"5: Existe una cultura consolidada de concientizacin y participacin, con evidencia de mejora y compromiso institucional."}},{codigo:"4.4",pregunta:"Existe comunicacin interna y externa eficaz sobre los temas de gestin ambiental (campaas, informes, circulares, reuniones, reportes)?",queImplica:"La comunicacin eficaz es esencial para garantizar que la informacin relacionada con la gestin ambiental sea comprendida, compartida y aplicada correctamente. Incluye tanto la comunicacin interna entre los diferentes niveles y reas del predio, como la comunicacin externa con partes interesadas (autoridades, comunidad, proveedores, entre otros). Una buena comunicacin fortalece la transparencia, la participacin y el compromiso institucional.",comoCumplir:" Establecer canales formales de comunicacin (correos institucionales, carteleras, reuniones, boletines o plataformas digitales).  Definir qu informacin se comunica, a quin, cundo y por qu medio.  Asegurar que los mensajes sean claros y lleguen a todas las partes interesadas.  Promover la retroalimentacin y el registro de las comunicaciones ms importantes.  Publicar informes, campaas o resultados del sistema en medios accesibles y actualizados.",evidencias:" Registros de comunicaciones internas (correos, actas, boletines, carteleras).  Informes de gestin o reportes de resultados.  Publicaciones institucionales o comunicados oficiales.  Registros de reuniones o socializaciones.  Procedimiento de comunicacin documentado.",criterios:{1:"1: No existen mecanismos formales de comunicacin.",2:"2: La comunicacin es espordica o depende de iniciativas individuales.",3:"3: Existen canales establecidos, pero sin planificacin ni registro.",4:"4: Comunicacin interna y externa estructurada, con evidencia documental y participacin activa.",5:"5: Sistema de comunicacin consolidado, con seguimiento, retroalimentacin y actualizacin continua."}},{codigo:"4.5",pregunta:"Se mantienen actualizados y controlados los documentos y registros del sistema de gestin ambiental (formatos, procedimientos, informes, manuales)?",queImplica:"El control de documentos y registros garantiza la trazabilidad, coherencia y confiabilidad de la informacin del sistema de gestin. Implica que todos los documentos (manuales, procedimientos, formatos e informes) estn actualizados, aprobados, disponibles en su versin vigente y protegidos contra prdida o uso no autorizado. Los registros, por su parte, deben conservarse de manera organizada para evidenciar el cumplimiento de los requisitos y actividades del sistema.",comoCumplir:" Establecer un procedimiento formal para la creacin, revisin, aprobacin, distribucin y control de documentos.  Identificar claramente las versiones vigentes y asegurar que los documentos obsoletos se retiren o marquen adecuadamente.  Mantener registros accesibles, legibles y protegidos.  Revisar peridicamente la documentacin para garantizar su vigencia.  Implementar herramientas digitales o archivos fsicos organizados segn las necesidades del predio.",evidencias:" Procedimiento de control documental.  Listado maestro de documentos y registros.  Versiones controladas de manuales, procedimientos y formatos.  Evidencia de revisin o actualizacin.  Archivos digitales o fsicos organizados.  Registros de auditoras o revisiones internas.",criterios:{1:"1: No existe control documental ni registros actualizados.",2:"2: Existen algunos documentos, pero sin control de versiones ni trazabilidad.",3:"3: Se cuenta con documentacin bsica, aunque no se mantiene actualizada o controlada.",4:"4: Documentos y registros actualizados, controlados y disponibles para el personal.",5:"5: Sistema documental consolidado, digitalizado o fsico, con control de versiones, respaldo y revisin peridica."}},{codigo:"5.1",pregunta:"Se controlan las actividades operativas con potencial impacto ambiental o que puedan afectar la calidad del servicio (uso de maquinaria, agroqumicos, gestin de residuos, mantenimiento, etc.)?",queImplica:"El control operacional busca asegurar que las actividades que puedan generar impactos ambientales o afectar la calidad del servicio se realicen bajo condiciones planificadas y controladas. Esto permite prevenir daos, optimizar recursos, mantener la coherencia con los objetivos del sistema y cumplir con los requisitos legales y normativos aplicables.",comoCumplir:" Identificar las actividades crticas que requieren control (uso de maquinaria, manejo de residuos, consumo de energa, procesos de mantenimiento o atencin al usuario).  Establecer procedimientos, instructivos o rutinas operativas que definan cmo deben realizarse.  Capacitar al personal involucrado y verificar peridicamente el cumplimiento de los controles.  Implementar registros, listas de chequeo o monitoreos que evidencien la ejecucin adecuada de las actividades.",evidencias:" Procedimientos operativos o instructivos documentados.  Registros de mantenimiento, control de residuos y uso de equipos.  Listas de chequeo o formularios de verificacin.  Informes de inspeccin o monitoreo.  Registros fotogrficos o reportes de cumplimiento.",criterios:{1:"1: No se controlan las actividades operativas con potencial impacto.",2:"2: Existen controles informales o no documentados.",3:"3: Algunos procesos estn controlados, pero sin seguimiento ni registros.",4:"4: Actividades operativas controladas mediante procedimientos y evidencias verificables.",5:"5: Controles operativos integrados, revisados peridicamente y con resultados demostrables de mejora."}},{codigo:"5.2",pregunta:"Existen y se aplican protocolos de respuesta ante emergencias ambientales o de operacin (derrames, incendios, escapes de gas, fallas de equipos, interrupciones del servicio, etc.)?",queImplica:"La preparacin y respuesta ante emergencias es fundamental para prevenir daos a las personas, al ambiente y a la infraestructura, as como para garantizar la continuidad de las operaciones. El predio debe contar con procedimientos claros, personal capacitado y recursos disponibles para responder de manera eficaz ante situaciones imprevistas que puedan afectar la gestin ambiental o la calidad del servicio.",comoCumplir:" Identificar los posibles escenarios de emergencia asociados a las actividades del predio.  Elaborar protocolos o planes de emergencia que definan las acciones a seguir, los responsables, los recursos y las rutas de evacuacin.  Capacitar al personal y realizar simulacros peridicos.  Revisar y actualizar los planes segn los resultados de los ejercicios, cambios en las operaciones o nuevas condiciones del entorno.",evidencias:" Plan o procedimiento de emergencias actualizado.  Registros de simulacros o capacitaciones.  Listas de asistencia y evaluaciones de desempeo.  Reportes de incidentes o acciones correctivas.  Sealizacin, kits de emergencia y equipos de seguridad visibles y operativos.",criterios:{1:"1: No existen protocolos ni medidas de respuesta ante emergencias.",2:"2: Existen acciones bsicas, pero sin documentacin ni capacitacin.",3:"3: Protocolos definidos, pero sin simulacros ni evidencia de aplicacin.",4:"4: Protocolos documentados y aplicados con capacitacin y seguimiento peridico.",5:"5: Sistema de gestin de emergencias consolidado, con revisin continua, simulacros regulares y mejora comprobada."}},{codigo:"6.1",pregunta:"Se realiza seguimiento, medicin y monitoreo de los indicadores ambientales (agua, energa, residuos, emisiones, satisfaccin de usuarios, eficiencia de procesos, etc.)?",queImplica:"El seguimiento y medicin de indicadores permite evaluar el desempeo del sistema de gestin ambiental, identificar desviaciones y promover la mejora continua. Implica recopilar, analizar y utilizar datos confiables para tomar decisiones informadas sobre el uso de recursos, el cumplimiento de los objetivos y la eficacia de los procesos.",comoCumplir:" Definir indicadores claros y medibles que reflejen los aspectos ms relevantes del desempeo ambiental.  Establecer una frecuencia de medicin y asignar responsables para la recopilacin y anlisis de los datos.  Registrar los resultados, compararlos con las metas establecidas y comunicar los avances a la direccin y al personal.  Utilizar los resultados para planificar acciones de mejora o correccin.",evidencias:" Matriz o tablero de indicadores.  Registros de medicin (consumo de agua, energa, residuos generados, satisfaccin de usuarios, etc.).  Informes de seguimiento y anlisis de resultados.  Grficos o reportes de tendencias.  Actas de reuniones donde se discuten los resultados.",criterios:{1:"1: No se realiza seguimiento ni medicin de indicadores.",2:"2: Se miden algunos datos sin registros ni anlisis formal.",3:"3: Indicadores definidos, pero sin seguimiento continuo ni comunicacin de resultados.",4:"4: Indicadores medidos peridicamente con anlisis y acciones derivadas.",5:"5: Sistema de monitoreo consolidado, con anlisis comparativo, tendencias y toma de decisiones basada en datos."}},{codigo:"6.2",pregunta:"Se realizan auditoras internas peridicas que evalan el cumplimiento de los requisitos del sistema de gestin ambiental?",queImplica:"Las auditoras internas son una herramienta fundamental para verificar que el sistema de gestin ambiental se implementa de manera eficaz y cumple con los requisitos establecidos. Permiten detectar desviaciones, evaluar el desempeo de los procesos y proponer acciones de mejora antes de las auditoras externas o revisiones de la direccin.",comoCumplir:" Planificar un programa de auditoras internas con una frecuencia definida segn la criticidad de los procesos.  Seleccionar auditores competentes e independientes de las actividades que evalan.  Aplicar listas de verificacin basadas en los requisitos de las normas y procedimientos internos.  Registrar los hallazgos, comunicarlos a los responsables y hacer seguimiento a las acciones correctivas derivadas de las auditoras.",evidencias:" Programa anual de auditoras internas.  Informes o actas de auditoras realizadas.  Listas de chequeo y registros de hallazgos.  Planes de accin correctiva y seguimiento de su cumplimiento.  Registros de capacitacin de auditores internos.",criterios:{1:"1: No se realizan auditoras internas.",2:"2: Se han realizado auditoras espordicas o sin metodologa definida.",3:"3: Auditoras realizadas, pero sin seguimiento a los hallazgos o acciones correctivas.",4:"4: Auditoras planificadas y ejecutadas peridicamente con seguimiento de resultados.",5:"5: Sistema de auditoras consolidado, con anlisis de tendencias, mejora continua y participacin activa de la direccin."}},{codigo:"6.3",pregunta:"La direccin revisa peridicamente el desempeo del sistema de gestin ambiental, tomando decisiones basadas en los resultados de auditoras y monitoreos?",queImplica:"La revisin por la direccin asegura que los responsables institucionales evalen peridicamente la eficacia del sistema de gestin, identifiquen oportunidades de mejora y tomen decisiones informadas. Este proceso garantiza la alineacin del sistema con los objetivos estratgicos, los requisitos legales y las necesidades de las partes interesadas.",comoCumplir:" Programar reuniones de revisin por la direccin al menos una vez al ao o cuando sea necesario.  Analizar resultados de auditoras, indicadores, incidentes, quejas, cumplimiento legal y avances de los objetivos.  Registrar conclusiones, decisiones y acciones derivadas.  Hacer seguimiento a los compromisos para evidenciar la mejora continua.",evidencias:" Actas o informes de revisin por la direccin.  Listas de verificacin o presentaciones utilizadas.  Registros de decisiones y planes de accin.  Informes de seguimiento de acciones correctivas.  Comunicaciones oficiales o aprobaciones derivadas de la revisin.",criterios:{1:"1: No se realiza revisin por la direccin.",2:"2: Se realizan reuniones informales sin registro ni seguimiento.",3:"3: La revisin se hace espordicamente o sin analizar toda la informacin del sistema.",4:"4: Revisin documentada, con anlisis de resultados y decisiones tomadas.",5:"5: Revisin peridica, documentada y con evidencia de decisiones estratgicas que impulsan la mejora continua."}},{codigo:"7.1",pregunta:"Se gestionan adecuadamente las no conformidades y desviaciones del sistema de gestin ambiental (por ejemplo, incumplimientos de permisos, manejo de residuos, fallas en procesos o servicios)?",queImplica:"La gestin de no conformidades permite identificar, registrar y corregir los incumplimientos o fallas que afectan el desempeo ambiental o la calidad de los servicios. Un tratamiento adecuado de estas situaciones ayuda a prevenir su repeticin, mejorar los procesos y fortalecer la eficacia del sistema de gestin.",comoCumplir:" Establecer un procedimiento formal para la identificacin, registro, anlisis y correccin de no conformidades.  Incluir la investigacin de causas y la definicin de acciones correctivas apropiadas.  Asegurar que las no conformidades se documenten y que se haga seguimiento a su cierre y efectividad.  Comunicar los resultados a las partes responsables y analizar tendencias para prevenir recurrencias.",evidencias:" Registros de no conformidades o desviaciones.  Formularios o reportes de anlisis de causa raz.  Planes de accin correctiva.  Registros de verificacin de cierre.  Informes de auditoras internas y revisiones por la direccin.",criterios:{1:"1: No se gestionan las no conformidades ni se registran.",2:"2: Se identifican algunas no conformidades, pero sin registro ni seguimiento formal.",3:"3: Se documentan las no conformidades, pero sin anlisis de causas o acciones efectivas.",4:"4: No conformidades gestionadas mediante procedimientos documentados y seguimiento parcial.",5:"5: Sistema consolidado de gestin de no conformidades con anlisis de causas, acciones efectivas y mejora continua."}},{codigo:"7.2",pregunta:"Se aplican, documentan y evalan acciones correctivas y de mejora continua para garantizar la eficacia del sistema de gestin ambiental?",queImplica:"La aplicacin de acciones correctivas y de mejora continua asegura que el sistema de gestin evolucione y mantenga su eficacia con el tiempo. Las acciones correctivas eliminan las causas de las no conformidades detectadas, mientras que la mejora continua busca optimizar los procesos, aumentar la satisfaccin de las partes interesadas y fortalecer el desempeo ambiental.",comoCumplir:" Implementar un procedimiento para identificar oportunidades de mejora y gestionar las acciones correctivas derivadas de auditoras, revisiones o incidentes.  Documentar cada accin, sus responsables, plazos y resultados esperados.  Verificar la eficacia de las acciones mediante evaluaciones, seguimiento de indicadores o auditoras internas.  Promover la participacin del personal en la identificacin de mejoras y registrar las iniciativas exitosas.",evidencias:" Registros de acciones correctivas y de mejora.  Planes de accin con responsables y fechas.  Informes de seguimiento o cierre.  Actas de reuniones de mejora.  Registros de auditoras o revisiones de direccin.  Indicadores de desempeo que reflejen avances.",criterios:{1:"1: No se aplican acciones correctivas ni actividades de mejora.",2:"2: Se aplican algunas acciones, pero sin documentacin ni seguimiento.",3:"3: Existen registros de acciones correctivas, pero sin evaluacin de su eficacia.",4:"4: Acciones correctivas y de mejora documentadas, implementadas y con seguimiento regular.",5:"5: Sistema de mejora continua consolidado, con evaluacin sistemtica, resultados medibles y participacin activa del personal."}}];function Rn(r,e=Qs){if(!r)return;let t=document.querySelector(".tooltip-card.__shared");t||(t=document.createElement("div"),t.className="tooltip-card __shared",document.body.appendChild(t));let s=null;const i=c=>{const l=(u,h)=>h?`<div class="tooltip-section"><b>${u}</b><div>${me(h)}</div></div>`:"",d=(u,h)=>{if(!h)return"";if(typeof h=="object"&&!Array.isArray(h)){const p=Object.entries(h).sort(([v],[b])=>String(v).localeCompare(String(b))).map(([,v])=>`<li>${me(v)}</li>`).join("");return`<div class="tooltip-section"><b>${u}</b><ul>${p}</ul></div>`}const m=String(h).split(/\r?\n|;|/).map(g=>g.trim()).filter(Boolean);return m.length>=2?`<div class="tooltip-section"><b>${u}</b><ul>${m.map(g=>`<li>${me(g)}</li>`).join("")}</ul></div>`:l(u,String(h))},f=c!=null&&c.sugerencias?`<div class="tooltip-section"><b>Sugerencias</b><div class="tooltip-grid">${Object.entries(c.sugerencias).map(([u,h])=>`<div><b>${me(u)}:</b> <span>${me(h)}</span></div>`).join("")}</div></div>`:"";return`
      ${l("Qu implica",c.queImplica)}
      ${l("Cmo cumplir",c.comoCumplir)}
      ${l("Evidencias",c.evidencias)}
      ${d("Criterios",c.criterios)}
      ${f}
    `};t.addEventListener("mouseenter",()=>{s&&(clearTimeout(s),s=null)}),t.addEventListener("mouseleave",()=>n());function n(){s&&clearTimeout(s),s=setTimeout(()=>{t.classList.remove("visible")},220)}function a(c,l,d){t.innerHTML=c;const f=12;let u=l.right+f,h=l.top;const m=t.getBoundingClientRect(),g=window.innerWidth,p=window.innerHeight;u+m.width>g-10&&(u=Math.max(10,l.left-m.width-f)),h+m.height>p-10&&d&&(h=Math.max(10,d.bottom-m.height)),h<10&&(h=10),u<10&&(u=10),t.style.left=u+"px",t.style.top=h+"px",t.offsetHeight,t.classList.add("visible")}function o(c){var h,m;const l=(h=c.dataset.codigo)==null?void 0:h.trim(),d=(m=c.dataset.pregunta)==null?void 0:m.trim(),f=e.find(g=>g.codigo===l)||e.find(g=>!!d&&g.pregunta&&d.startsWith(g.pregunta.slice(0,18)));if(!f)return;let u=c.querySelector(".help-icon");if(!u){const g=c.querySelector("strong")||c.firstElementChild;u=document.createElement("span"),u.className="help-icon",u.setAttribute("title","Ayuda"),u.textContent="",g&&g.parentNode?g.parentNode.insertBefore(u,g.nextSibling):c.insertBefore(u,c.firstChild)}u.addEventListener("mouseenter",()=>{s&&(clearTimeout(s),s=null);const g=u.getBoundingClientRect(),p=c.getBoundingClientRect();a(i(f),g,p)}),u.addEventListener("mouseleave",()=>n())}r.querySelectorAll(".question-card").forEach(o)}function me(r){return r==null?"":String(r).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}async function Ht(r="#app-question"){var h,m,g;const e=typeof r=="string"?document.querySelector(r):r;if(!e)return;e.innerHTML="";const t=document.createElement("div");t.className="card";const s=document.createElement("h3");s.textContent="Responder todas las preguntas",t.appendChild(s);const i=document.createElement("div");i.className="small",i.textContent='Complete un valor y/o observacin por cada pregunta y presione "Enviar todas"',t.appendChild(i);const n=document.createElement("div");n.className="form-row";let a=[];try{const{data:p,error:v}=await U.from("predios").select("*").order("id",{ascending:!0});if(v)throw v;a=p||[]}catch(p){console.error("Error cargando predios:",p)}const o=document.createElement("select");if(o.className="input-width",a.length>0)a.forEach(p=>{const v=p.nombre??p.name??p.predio??p.titulo??String(p.id),b=document.createElement("option");b.value=String(p.id),b.textContent=v,o.appendChild(b)});else{const p=document.createElement("option");p.value="1",p.textContent="Predio 1",o.appendChild(p)}const c=document.createElement("div");c.className="input-flex small",c.textContent="Evaluador: (no autenticado)",n.appendChild(o),n.appendChild(c),t.appendChild(n);const l=document.createElement("div");l.className="questions-grid",t.appendChild(l);const d=document.createElement("button");d.className="btn btn-margin",d.textContent="Enviar todas las respuestas",t.appendChild(d);const f=document.createElement("div");f.className="small",t.appendChild(f),e.appendChild(t);let u=[];try{const{data:p,error:v}=await U.from("preguntas").select("*").order("id",{ascending:!0});if(v)throw v;u=p||[]}catch(p){console.error("Error cargando preguntas:",p),f.textContent="Error cargando preguntas: "+(p.message||p);return}u.forEach(p=>{const v=document.createElement("div");v.className="card question-card",p.codigo&&(v.dataset.codigo=String(p.codigo)),p.pregunta&&(v.dataset.pregunta=String(p.pregunta));const b=document.createElement("div");b.innerHTML=`<strong>${p.codigo||""} ${p.titulo_clausula||""}</strong>`;const y=document.createElement("p");y.textContent=p.pregunta||"";const E=document.createElement("div");E.textContent=`Valor (${p.min_valor??1} - ${p.max_valor??5})`;const O=document.createElement("div");O.className="radio-group";const k=Number(p.min_valor??1),A=Number(p.max_valor??5);for(let j=k;j<=A;j++){const W=`preg-${p.id}-val-${j}`,C=document.createElement("label");C.className="radio-label";const D=document.createElement("input");D.type="radio",D.name=`pregunta-${p.id}`,D.value=String(j),D.id=W,D.dataset.preguntaId=String(p.id),D.className="input-radio",j===k&&(D.checked=!0);const B=document.createElement("span");B.textContent=String(j),C.appendChild(D),C.appendChild(B),O.appendChild(C)}const R=document.createElement("textarea");R.rows=2,R.className="textarea-full",R.placeholder="Observacin (opcional)",R.dataset.preguntaId=String(p.id),v.appendChild(b),v.appendChild(y),v.appendChild(E),v.appendChild(O),v.appendChild(R),l.appendChild(v)});try{Rn(l,Qs)}catch(p){console.warn("No se pudieron aplicar tooltips:",p)}try{const p=await U.auth.getSession(),v=((g=(m=(h=p==null?void 0:p.data)==null?void 0:h.session)==null?void 0:m.user)==null?void 0:g.email)||null;v&&(c.textContent=`Evaluador: ${v}`)}catch(p){console.warn("No se pudo obtener sesin:",p)}d.addEventListener("click",async()=>{var O,k,A;const p=Number(o.value)||1;let v=null;try{const R=await U.auth.getSession();v=((A=(k=(O=R==null?void 0:R.data)==null?void 0:O.session)==null?void 0:k.user)==null?void 0:A.email)||null}catch{v=null}const b=[],y=l.querySelectorAll('input[type="radio"][data-pregunta-id]'),E=new Set;for(const R of y){const j=Number(R.dataset.preguntaId);if(E.has(j))continue;const W=l.querySelector(`input[type="radio"][data-pregunta-id="${j}"]:checked`),C=u.find(Se=>Number(Se.id)===j);if(!C)continue;const D=Number(W?W.value:C.min_valor??1),B=l.querySelector(`textarea[data-pregunta-id="${j}"]`),Be=B&&B.value.trim()||null;b.push({predio_id:p,pregunta_id:j,valor:D,observacion:Be,evaluador:v,fecha:new Date().toISOString()}),E.add(j)}if(b.length===0){f.textContent="No hay respuestas para enviar.";return}f.textContent="Preparando envo de "+b.length+" respuestas...",d.disabled=!0;try{const R=[...new Set(b.map(C=>C.pregunta_id))];try{const C=await U.from("respuestas").delete().eq("predio_id",p).in("pregunta_id",R);C.error&&console.warn("No se pudieron eliminar previas:",C.error.message||C.error)}catch(C){console.warn("Error eliminando previas:",C)}f.textContent="Guardando nuevas respuestas...";const{data:j,error:W}=await U.from("respuestas").insert(b).select();if(W){console.error(W),f.textContent="Error al guardar: "+(W.message||W),d.disabled=!1;return}f.textContent="Respuestas guardadas: "+((j==null?void 0:j.length)??b.length);try{const C=l.querySelectorAll('input[type="radio"][data-pregunta-id]');for(const B of C)B.checked=!1;for(const B of u){const Be=String(B.min_valor??1),Se=l.querySelector(`input[type="radio"][data-pregunta-id="${B.id}"][value="${Be}"]`);Se&&(Se.checked=!0)}const D=l.querySelectorAll("textarea");for(const B of D)B.value="";f.textContent="Formulario reiniciado."}catch(C){console.error("No se pudo resetear el formulario:",C)}try{await lt("#app-respuestas")}catch(C){console.error("No se pudo refrescar la tabla de respuestas:",C)}try{await Xs("#app-progress")}catch(C){console.error("No se pudo refrescar el progreso por predio:",C)}}catch(R){console.error(R),f.textContent="Error inesperado al enviar."}d.disabled=!1})}async function lt(r="#app"){const e=typeof r=="string"?document.querySelector(r):r;if(!e)throw new Error("Elemento root no encontrado: "+r);e.innerHTML="";const t=document.createElement("div");t.className="card dashboard-main";const s=document.createElement("h2");s.textContent="Respuestas  public.respuestas",t.appendChild(s);const i=document.createElement("div");i.id="respuestasStatus",i.className="small",i.textContent="Cargando respuestas...",t.appendChild(i);const n=document.createElement("table");n.id="respuestasTable";const a=document.createElement("thead"),o=document.createElement("tr"),c=["idx","id","predio_id","pregunta_id","valor","observacion","evaluador","fecha"];c.forEach(h=>{const m=document.createElement("th");m.textContent=h,o.appendChild(m)}),a.appendChild(o),n.appendChild(a);const l=document.createElement("tbody");n.appendChild(l),t.appendChild(n);const d=document.createElement("div");d.className="form-row";const f=document.createElement("button");f.className="btn btn-secondary",f.textContent="Recargar respuestas",f.addEventListener("click",()=>u()),d.appendChild(f),t.appendChild(d),e.appendChild(t);async function u(){i.textContent="Consultando base de datos...",l.innerHTML="";try{const{data:h,error:m}=await U.from("respuestas").select("*").order("id",{ascending:!0});if(m){console.error("Error supabase:",m),i.textContent="Error al obtener respuestas: "+(m.message||m);return}if(!h||h.length===0){i.textContent="No se encontraron respuestas.";return}for(const g of h){const p=document.createElement("tr");c.forEach(v=>{const b=document.createElement("td");let y=g[v];if(v==="fecha"&&y){const E=new Date(y);isNaN(E)||(y=E.toLocaleString())}b.textContent=y==null?"":String(y),p.appendChild(b)}),l.appendChild(p)}i.textContent="Cargadas "+h.length+" respuestas."}catch(h){console.error("Error inesperado:",h),i.textContent="Error inesperado al cargar respuestas."}}await u()}async function Xs(r="#app-progress"){const e=typeof r=="string"?document.querySelector(r):r;if(!e)return;e.innerHTML="";const t=document.createElement("div");t.className="card";const s=document.createElement("h3");s.textContent="Avance por predio",t.appendChild(s);const i=document.createElement("div");i.className="small",i.textContent="Porcentaje de cumplimiento: respuestas con valor 5 representan cumplimiento total.",t.appendChild(i);let n=[];try{const{data:u,error:h}=await U.from("preguntas").select("id");if(h)throw h;n=u||[]}catch(u){console.error("Error cargando preguntas:",u),t.appendChild(document.createTextNode("Error cargando preguntas.")),e.appendChild(t);return}const a=n.length||0;if(a===0){const u=document.createElement("div");u.textContent="No hay preguntas registradas.",t.appendChild(u),e.appendChild(t);return}let o=[];try{const{data:u,error:h}=await U.from("respuestas").select("*");if(h)throw h;o=u||[]}catch(u){console.error("Error cargando respuestas:",u),t.appendChild(document.createTextNode("Error cargando respuestas.")),e.appendChild(t);return}const c=new Map;for(const u of o){const h=(u.predio_id??u.predio)||"unknown",m=c.get(h)||{total:0,total5:0};m.total+=1,Number(u.valor)===5&&(m.total5+=1),c.set(h,m)}let l=new Map;try{const u=Array.from(c.keys()).filter(h=>h!=="unknown").map(h=>Number(h)).filter(h=>!Number.isNaN(h));if(u.length){const{data:h,error:m}=await U.from("predios").select("id,nombre,name,predio,titulo,codigo").in("id",u);if(!m&&h)for(const g of h){const p=String(g.id),v=g.nombre??g.name??g.predio??g.titulo??g.codigo??null;v&&l.set(p,v)}}}catch(u){console.warn("No se pudo obtener nombres de predios:",u)}if(c.size===0){const u=document.createElement("div");u.textContent="No hay respuestas registradas por predio.",t.appendChild(u),e.appendChild(t);return}const d=document.createElement("div");d.className="progress-container",Array.from(c.entries()).map(([u,h])=>{const m=Math.round(h.total5/a*100);return{pid:u,stats:h,percent:m}}).sort((u,h)=>h.percent-u.percent).forEach(u=>{const h=document.createElement("div");h.className="progress-row";const m=String(u.pid),g=l.get(m),p=g||(u.pid==="unknown"?"Predio desconocido":`Predio ${u.pid}`),v=document.createElement("div");v.className="progress-label",v.textContent=`${p}  ${u.percent}%`;const b=document.createElement("div");b.className="progress-bar";const y=document.createElement("div");y.className="progress-fill",y.style.width=Math.min(100,Math.max(0,u.percent))+"%",b.appendChild(y),h.appendChild(v),h.appendChild(b),d.appendChild(h)}),t.appendChild(d),e.appendChild(t)}console.log("[login.js] cargado");const Zs=document.getElementById("app");function er(){Zs.innerHTML=`
    <section class="login-container">
        <h2>Iniciar sesin</h2>
        <form id="loginForm">
            <div class="input-box">
                <i></i>
                <input type="email" id="email" placeholder="Correo electrnico" required />
            </div>
            <div class="input-box">
                <i></i>
                <input type="password" id="password" placeholder="Contrasea" required />
            </div>
            <button type="submit" class="btn">Entrar</button>
        </form>

        <p style="margin:16px 0;"></p>  
        <p>No tienes cuenta? <a href="#" id="signupLink">Regstrate</a></p>

        <div id="register" style="display:none; margin-top:20px;">
            <h2>Crear cuenta</h2>
            <div class="input-box">
                <i></i>
                <input type="email" id="regEmail" placeholder="Correo electrnico" />
            </div>
            <div class="input-box">
                <i></i>
                <input type="password" id="regPass" placeholder="Contrasea" />
            </div>
            <button id="btnRegister" class="btn">Registrar</button>
        </div>
    </section>
`,document.body.classList.add("auth-page"),document.getElementById("loginForm").addEventListener("submit",An),document.getElementById("signupLink").addEventListener("click",In),document.getElementById("btnRegister").addEventListener("click",Cn)}async function tr(r){Zs.innerHTML=`
    <nav>
      <label class="logo">Bienvenido, ${r.email}</label>
      <ul>
          <li><a href="#" id="btnLogout" class="btn btn-danger">Salir</a></li>
      </ul>
    </nav>
    <main id="dashboardContent" class="dashboard-main"></main>
  `,document.body.classList.remove("auth-page");const e=document.getElementById("btnLogout");e&&e.addEventListener("click",Pn);try{const t=document.getElementById("dashboardContent");if(t)t.innerHTML='<div id="app-question"></div><div id="app-respuestas" style="margin-top:16px"></div><div id="app-progress" style="margin-top:18px"></div>',console.log("[login.js] renderizando form de preguntas (primero)..."),await Ht("#app-question"),console.log("[login.js] renderizando tabla de respuestas (despus)..."),await lt("#app-respuestas"),console.log("[login.js] renderizando tablero de progreso por predio (ltimo)..."),await Xs("#app-progress");else{console.log("[login.js] dashboardContent no encontrado, renderizando en #dashboardContent"),await lt("#dashboardContent");let s=document.getElementById("app-question");s||(s=document.createElement("div"),s.id="app-question",document.getElementById("dashboardContent").appendChild(s)),await Ht("#app-question")}}catch(t){console.error("Error renderizando dashboard:",t)}}async function An(r){r.preventDefault();const e=document.getElementById("email").value.trim(),t=document.getElementById("password").value.trim(),{data:s,error:i}=await U.auth.signInWithPassword({email:e,password:t});if(i)return alert(" "+i.message);tr(s.user)}async function Cn(){const r=document.getElementById("regEmail").value.trim(),e=document.getElementById("regPass").value.trim(),{error:t}=await U.auth.signUp({email:r,password:e});if(t)return alert(" "+t.message);alert(" Cuenta creada. Revisa tu correo para confirmar.")}async function Pn(r){r&&typeof r.preventDefault=="function"&&r.preventDefault(),await U.auth.signOut(),er()}function In(r){r.preventDefault();const e=document.getElementById("register");e.style.display=e.style.display==="none"?"block":"none"}window.onload=async()=>{const{data:{session:r}}=await U.auth.getSession();r?tr(r.user):er()};
